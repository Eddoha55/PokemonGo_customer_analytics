<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Leonard Henriquez, Adrien Lequiller &amp; Eddy Ohayon" />

<meta name="date" content="2019-04-03" />

<title>PokemonGo customer analytics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("index.Rmd");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PokemonGo customer analytics</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">PokemonGo customer analytics</h1>
<h4 class="author"><em><a href="https://github.com/leonard-henriquez/">Leonard Henriquez</a>, <a href="https://github.com/adrienlequiller">Adrien Lequiller</a> &amp; <a href="https://github.com/Eddoha55">Eddy Ohayon</a></em></h4>
<h4 class="date"><em>2019-04-03</em></h4>

</div>


<div id="assignment-i-basetable" class="section level1">
<h1>Assignment I, Basetable</h1>
<div id="data-importation-and-cleaning" class="section level3">
<h3>Data importation and cleaning</h3>
<ol style="list-style-type: decimal">
<li>First, let’s start by reading the customer’ data:</li>
</ol>
<pre class="r"><code># Import customers data
customer &lt;- read.csv(&quot;input/customerdata.csv&quot; )

# Clean data
customer$Registrationdate &lt;- as.Date(customer$Registrationdate)
customer$fallbonus        &lt;- as.factor(customer$fallbonus)
customer$CustomerType     &lt;- as.factor(customer$CustomerType)
customer$Sex              &lt;- as.factor(customer$Sex)
customer$Income           &lt;- as.factor(customer$Income)

#Let&#39;s create categories of Age (that could be relevant for the rest) :
customer &lt;- customer %&gt;%
  mutate(Age_category=
    ifelse(between(Age, 6, 17), &#39;6-17&#39;,
    ifelse(between(Age, 18, 23), &#39;18-23&#39;,
    ifelse(between(Age, 24, 35), &#39;24-35&#39;,
    ifelse(between(Age, 36, 50), &#39;36-50&#39;, &#39;&gt;51&#39;
  )))))
customer$Age_category &lt;- factor(customer$Age_category, levels=c(&#39;6-17&#39;, &#39;18-23&#39;, &#39;24-35&#39;, &#39;36-50&#39;, &#39;&gt;51&#39;))

# And let&#39;s check what we have
summary(customer)</code></pre>
<pre><code>##        X          CustomerID   CustomerType Registrationdate     Sex     
##  Min.   :   1   Min.   :   1   1:1277       Min.   :2016-07-01   0:2981  
##  1st Qu.:1251   1st Qu.:1251   2:1282       1st Qu.:2016-12-08   1:2019  
##  Median :2500   Median :2500   3:1121       Median :2018-01-01           
##  Mean   :2500   Mean   :2500   4:1320       Mean   :2017-08-13           
##  3rd Qu.:3750   3rd Qu.:3750                3rd Qu.:2018-03-02           
##  Max.   :5000   Max.   :5000                Max.   :2018-04-30           
##       Age       fallbonus Income   Age_category
##  Min.   : 6.0   0:4000    1:1671   6-17 :1241  
##  1st Qu.:18.0   1:1000    2:1605   18-23: 639  
##  Median :27.0             3:1724   24-35:2224  
##  Mean   :27.5                      36-50: 655  
##  3rd Qu.:33.0                      &gt;51  : 241  
##  Max.   :80.0</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Now let’s check the transactions:</li>
</ol>
<pre class="r"><code># Import transactions
tx.fall   &lt;- read.csv(&quot;input/fallfintrx.csv&quot;   )
tx.summer &lt;- read.csv(&quot;input/summerfintrx.csv&quot; )

# We need to add monetary value and convert the date
# This is the list of prices for each ProductID
prices    &lt;- c(2.99, 4.99, 9.99, 25, 99)
tx.fall   &lt;- tx.fall   %&gt;% mutate(Value = prices[ProductID], Date = as.Date(Date))
tx.summer &lt;- tx.summer %&gt;% mutate(Value = prices[ProductID], Date = as.Date(Date))

# Then we create a data frame with all data
tx.all    &lt;- tx.fall %&gt;% union(tx.summer)

# And let&#39;s check what we have
summary(tx.all)</code></pre>
<pre><code>##        X           TransID          Date              CustomerID  
##  Min.   :   1   Min.   :   1   Min.   :2018-05-02   Min.   :   4  
##  1st Qu.: 387   1st Qu.: 387   1st Qu.:2018-06-12   1st Qu.:1380  
##  Median : 773   Median : 773   Median :2018-07-22   Median :2570  
##  Mean   : 925   Mean   : 925   Mean   :2018-07-25   Mean   :2554  
##  3rd Qu.:1459   3rd Qu.:1459   3rd Qu.:2018-09-07   3rd Qu.:3766  
##  Max.   :2231   Max.   :2231   Max.   :2018-10-31   Max.   :4999  
##    ProductID        Value      
##  Min.   :1.00   Min.   : 2.99  
##  1st Qu.:1.00   1st Qu.: 2.99  
##  Median :2.00   Median : 4.99  
##  Mean   :2.08   Mean   : 8.86  
##  3rd Qu.:3.00   3rd Qu.: 9.99  
##  Max.   :5.00   Max.   :99.00</code></pre>
<p>For later we need to keep the dates of beginning and ending of the periods:</p>
<pre class="r"><code># This will correspond to the history period to build the models
fall.begin   &lt;- min(tx.fall$Date)
fall.end     &lt;- max(tx.fall$Date)

# This will correspond to the forecast period to build and evaluate the models
summer.begin &lt;- min(tx.summer$Date)
summer.end   &lt;- max(tx.summer$Date)

# This will correspond to the entire period to build the final model
all.begin    &lt;- min(tx.all$Date)
all.end      &lt;- max(tx.all$Date)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>And finally the sessions:</li>
</ol>
<pre class="r"><code># Import sessions
sessions.fall         &lt;- read.csv(&quot;input/fallsesstrx.csv&quot;  )
sessions.summer       &lt;- read.csv(&quot;input/summersesstrx.csv&quot;)
sessions.fall$Date    &lt;- as.Date(sessions.fall$Date)
sessions.summer$Date  &lt;- as.Date(sessions.summer$Date)

sessions.all          &lt;- sessions.fall %&gt;% union(sessions.summer)</code></pre>
</div>
<div id="rfm-analysis" class="section level3">
<h3>RFM Analysis</h3>
<p>The point of this part is to calculate the RFM for all active customers. We could base our RFM analysis either on sessions or on transactions. We opted for RFM analysis based on transactions because it is a better proxy for monetary value of a customer.</p>
<p>We defined:</p>
<ul>
<li><strong>Recency</strong> as the number of days since last transaction</li>
<li><strong>Frequency</strong> as the number of transactions</li>
<li><strong>Monetary</strong> value as the total value of all products bought in the period</li>
</ul>
<pre class="r"><code># Calculated RFM based on all transactions (summer and fall)
# for each customer (who made at least one transaction)
customer.RFM &lt;- tx.all %&gt;%
  group_by(CustomerID) %&gt;%
  summarise(Recency = as.numeric(all.end-max(Date)), Frequency = n(), Monetary = sum(Value))

summary(customer.RFM)</code></pre>
<pre><code>##    CustomerID      Recency        Frequency      Monetary     
##  Min.   :   4   Min.   :  0.0   Min.   :1.0   Min.   :  2.99  
##  1st Qu.:1360   1st Qu.: 44.5   1st Qu.:1.0   1st Qu.:  4.99  
##  Median :2551   Median : 87.0   Median :2.0   Median :  9.98  
##  Mean   :2543   Mean   : 86.7   Mean   :1.8   Mean   : 15.99  
##  3rd Qu.:3768   3rd Qu.:129.0   3rd Qu.:2.0   3rd Qu.: 20.95  
##  Max.   :4999   Max.   :182.0   Max.   :8.0   Max.   :207.98</code></pre>
<p>Attention: since this list is build from <code>tx.all</code> it will only contain customers that made <strong>at least one transaction</strong>.</p>
<p>Now let’s create a list of active customers:</p>
<pre class="r"><code># Get all customerIDs of people who played at least once during the summer
customerID.active &lt;- sessions.summer %&gt;%
  select(CustomerID) %&gt;%
  distinct(CustomerID)</code></pre>
<p>Now we have enough to create a RFM table of active customers but we might want other informations on sessions played. So, let’s create a table that summarise the information of the sessions played by customers:</p>
<pre class="r"><code>customer.stats &lt;- sessions.all %&gt;%
  group_by(CustomerID) %&gt;%
  select(-c(X, PlayID, Date)) %&gt;%
  summarise_all(funs(sum))

summary(customer.stats)</code></pre>
<pre><code>##    CustomerID     Experience       Pokestops          Gyms      
##  Min.   :   1   Min.   :  1767   Min.   :  9.0   Min.   :  2.0  
##  1st Qu.:1253   1st Qu.: 13473   1st Qu.: 49.0   1st Qu.: 21.0  
##  Median :2502   Median : 21504   Median : 77.0   Median : 36.0  
##  Mean   :2501   Mean   : 24695   Mean   : 85.1   Mean   : 40.7  
##  3rd Qu.:3751   3rd Qu.: 31965   3rd Qu.:115.0   3rd Qu.: 55.0  
##  Max.   :5000   Max.   :142475   Max.   :306.0   Max.   :173.0  
##      Raids           Social         Pokemons      Distance     
##  Min.   : 0.00   Min.   : 0.00   Min.   :  4   Min.   :  0.45  
##  1st Qu.: 0.00   1st Qu.: 1.00   1st Qu.: 52   1st Qu.:  7.27  
##  Median : 1.00   Median : 3.00   Median : 88   Median : 13.42  
##  Mean   : 4.01   Mean   : 6.31   Mean   :102   Mean   : 19.44  
##  3rd Qu.: 5.00   3rd Qu.: 7.00   3rd Qu.:136   3rd Qu.: 25.11  
##  Max.   :67.00   Max.   :68.00   Max.   :508   Max.   :129.14  
##     Duration   
##  Min.   :  12  
##  1st Qu.: 122  
##  Median : 213  
##  Mean   : 357  
##  3rd Qu.: 390  
##  Max.   :3344</code></pre>
<p>Finally, we just need to combine the tables built previously to get our basetable:</p>
<pre class="r"><code># Add all informations to the table with all customers
recency.max = max(customer.RFM$Recency) + 1

customer &lt;- customer %&gt;%
  left_join(customer.stats, by = &quot;CustomerID&quot;) %&gt;%
  left_join(customer.RFM, by = &#39;CustomerID&#39;) %&gt;%
  select(-X) %&gt;%
  # We need to replace we 0 the missing values corresponding to customer who never bought any item
  mutate(
    Recency = replace_na(Recency, max(recency.max)),
    Frequency = replace_na(Frequency, 0),
    Monetary = replace_na(Monetary, 0)
  )

# Filter only active customers
customer.active &lt;- customer %&gt;% filter(CustomerID %in% customerID.active$CustomerID)

# final basetable
summary(customer.active)</code></pre>
<pre><code>##    CustomerID   CustomerType Registrationdate     Sex           Age      
##  Min.   :   1   1:1225       Min.   :2016-07-01   0:2815   Min.   : 6.0  
##  1st Qu.:1252   2:1144       1st Qu.:2016-12-07   1:1902   1st Qu.:18.0  
##  Median :2506   3:1069       Median :2017-12-16            Median :27.0  
##  Mean   :2502   4:1279       Mean   :2017-08-10            Mean   :27.6  
##  3rd Qu.:3751                3rd Qu.:2018-03-01            3rd Qu.:33.0  
##  Max.   :5000                Max.   :2018-04-30            Max.   :80.0  
##  fallbonus Income   Age_category   Experience       Pokestops    
##  0:3771    1:1571   6-17 :1172   Min.   :  1767   Min.   : 10.0  
##  1: 946    2:1509   18-23: 598   1st Qu.: 14127   1st Qu.: 52.0  
##            3:1637   24-35:2097   Median : 22257   Median : 80.0  
##                     36-50: 616   Mean   : 25343   Mean   : 87.4  
##                     &gt;51  : 234   3rd Qu.: 32654   3rd Qu.:116.0  
##                                  Max.   :142475   Max.   :306.0  
##       Gyms           Raids          Social         Pokemons  
##  Min.   :  2.0   Min.   : 0.0   Min.   : 0.00   Min.   :  4  
##  1st Qu.: 23.0   1st Qu.: 0.0   1st Qu.: 1.00   1st Qu.: 56  
##  Median : 37.0   Median : 1.0   Median : 3.00   Median : 91  
##  Mean   : 41.8   Mean   : 4.1   Mean   : 6.48   Mean   :104  
##  3rd Qu.: 56.0   3rd Qu.: 6.0   3rd Qu.: 7.00   3rd Qu.:137  
##  Max.   :173.0   Max.   :67.0   Max.   :68.00   Max.   :508  
##     Distance         Duration       Recency      Frequency    
##  Min.   :  0.45   Min.   :  12   Min.   :  0   Min.   :0.000  
##  1st Qu.:  7.66   1st Qu.: 128   1st Qu.:118   1st Qu.:0.000  
##  Median : 13.93   Median : 219   Median :183   Median :0.000  
##  Mean   : 19.94   Mean   : 367   Mean   :148   Mean   :0.655  
##  3rd Qu.: 25.88   3rd Qu.: 400   3rd Qu.:183   3rd Qu.:1.000  
##  Max.   :129.14   Max.   :3344   Max.   :183   Max.   :8.000  
##     Monetary     
##  Min.   :  0.00  
##  1st Qu.:  0.00  
##  Median :  0.00  
##  Mean   :  5.80  
##  3rd Qu.:  4.99  
##  Max.   :207.98</code></pre>
</div>
<div id="customer-lifetime-value" class="section level3">
<h3>Customer Lifetime Value</h3>
<p>Customer Lifetime Value (CLV) is given by the formula:</p>
<p><span class="math display">\[\sum_{t=0}^{T} m \frac{r^{t}}{(1+d)^{t}}-AC\]</span></p>
<p>In order to calculate it we have 5 parameters to estimate:</p>
<ul>
<li><span class="math inline">\(d\)</span>: Discount rate (Cost of Capital)</li>
<li><span class="math inline">\(AC\)</span>: Acquisition costs (per customer)</li>
<li><span class="math inline">\(r\)</span>: Retention probability for the customer</li>
<li><span class="math inline">\(T\)</span>: Number of years ‘out’</li>
<li><span class="math inline">\(m\)</span>: Customer recurring contribution margin (which is equal to recurring revenues less recurring costs)</li>
</ul>
<p>Now let’s make (reasonable) assumptions on those parameters. First, we decided to estimate all parameters excepted <span class="math inline">\(m\)</span> by values common to all customers. For <span class="math inline">\(d\)</span> or <span class="math inline">\(T\)</span>, we have no reason to consider a different cost of capital or number of year out for a customer or another. For <span class="math inline">\(AC\)</span> we have no information concerning marketing operations that may have impacted it excepted the fall bonus, but we believe that it had little cost, little opportunity cost and had mostly an impact on <span class="math inline">\(r\)</span>. On the opposite, we decided to estimate <span class="math inline">\(m\)</span> at a customer level based on past purchasing behaviour. For the purpose of this assignment we decided not to do the same technique for <span class="math inline">\(r\)</span> since we’ll do it in assigment III.</p>
<p><strong>Discount Rate</strong></p>
<p>Since we are studying an industry where customers have relatively small lifespan (inferior to 3 years), cost of capital will have a relatively small impact on CLV. We decided to take <span class="math inline">\(d\)</span> = 10% which seems to be a reasonable assumption for the software industry according to a <a href="http://people.stern.nyu.edu/adamodar/New_Home_Page/datafile/wacc.htm">NYU study</a>.</p>
<pre class="r"><code>CLV.d &lt;- 0.1</code></pre>
<p><strong>Acquisition Cost</strong> (per customer)</p>
<p>First, let’s estimate the budget allocated to marketing given the assumption that it represents 15% of the revenues:</p>
<pre class="r"><code># We&#39;ll need the period of time of transactions
days_in_period &lt;- as.numeric(all.end - all.begin)

# Total daily revenues
total_daily_revenues &lt;- sum(tx.all$Value) / days_in_period

# Total daily amount spend in marketing
total_daily_marketing_cost &lt;- 0.15 * total_daily_revenues</code></pre>
<p>Now given this daily marketing spending, let’s estimate the cost of acquisition per customer:</p>
<pre class="r"><code># We&#39;ll need the period of time of registration
days_in_registration_period &lt;- as.numeric(max(sessions.all$Date) - min(as.Date(customer$Registrationdate)))

# Now we want to calculate the cost per customer
CLV.AC &lt;- total_daily_marketing_cost * days_in_registration_period / nrow(customer)

sprintf(&quot;Acquisition Cost is estimated to: $%.2f&quot;, CLV.AC)</code></pre>
<pre><code>## [1] &quot;Acquisition Cost is estimated to: $3.84&quot;</code></pre>
<p><strong>Retention rate</strong></p>
<p>First we’ll need to define when we consider that a customer has churned. In this assignment we decided to define churning based on activity (number of sessions played) and not on financial transactions. You may check assigment 3 if you are interested in a definition of churning based on transactions.</p>
<p>To do that we might want to look at an histogram of the average time (in days) between two sessions. Let’s do that:</p>
<pre class="r"><code>customer.sessions &lt;- sessions.all %&gt;%
  group_by(CustomerID) %&gt;%
  # avg_interval is the average interval in days between the first and the last session of a customer
  summarise(first = min(Date), last = max(Date), count = n(), avg_interval = as.numeric(last - first)/count) %&gt;%
  # we can&#39;t calculate an interval with only one value so let&#39;s remove those lines
  filter(count &gt; 1)

# Now let&#39;s plot that
ggplot(customer.sessions) + geom_histogram(binwidth = 10) + aes(x = avg_interval)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>We notice that more than 99% of customers have an average day interval between sessions inferior to 60 days. So let’s define an active user as someone who played at least once in the last 60 days. Thus a user has churned if he has not played sessions in more than 60 days.</p>
<p>Now to determine retention. To do this:</p>
<ol style="list-style-type: decimal">
<li>We’ll take a cohort of “active” as of June 30th (all the customers who played at least on session in may or june)</li>
<li>In this cohort we’ll check which one are still “active” as of October 31st (all the customers who played at least one session in september or october)</li>
<li>The ratio of (2) over (1) represents the 4-month retention rate</li>
<li>We will need to transform it to the annual retention rate</li>
</ol>
<pre class="r"><code># 1) Cohort
cohort &lt;- sessions.all %&gt;%
  filter(Date &gt;= as.Date(&quot;2018-05-01&quot;), Date &lt; as.Date(&quot;2018-07-01&quot;)) %&gt;%
  group_by(CustomerID) %&gt;%
  distinct(CustomerID) %&gt;%
  select(CustomerID)

# 2) Customer in cohort still active as of October 31st
active &lt;- sessions.all %&gt;%
  filter(Date &gt;= as.Date(&quot;2018-09-01&quot;), Date &lt; as.Date(&quot;2018-11-01&quot;)) %&gt;%
  group_by(CustomerID) %&gt;%
  distinct(CustomerID) %&gt;%
  select(CustomerID)
cohort.active &lt;- cohort %&gt;% inner_join(active, by = &quot;CustomerID&quot;)

# 3) 4-month retention rate
r.4m &lt;- nrow(cohort.active) / nrow(cohort)

# 4) 1-year retention rate
CLV.r &lt;- r.4m^(12/4)

sprintf(&quot;Retention rate is estimated to: %.2f percent&quot;, CLV.r*100)</code></pre>
<pre><code>## [1] &quot;Retention rate is estimated to: 38.93 percent&quot;</code></pre>
<p><strong>Number of years ‘out’</strong></p>
<p>In order to take no risk we will take <span class="math inline">\(T\)</span> so that after <span class="math inline">\(T\)</span> years a customer has a probability of having churn superior to 90%. In mathematical language this gives us: <span class="math inline">\(T = ln(0.1) / ln(r)\)</span></p>
<pre class="r"><code>CLV.T &lt;- log(0.1) / log(CLV.r)

sprintf(&quot;Number of years &#39;out&#39; is estimated to: %.2f years&quot;, CLV.T)</code></pre>
<pre><code>## [1] &quot;Number of years &#39;out&#39; is estimated to: 2.44 years&quot;</code></pre>
<p><strong>Customer recurring contribution margin</strong></p>
<p>Now we want to estimate the contribution margin generated by a customer.</p>
<p>For the purpose on this assignment we decided to assume that the recurring cost for all customers represented 10% of total revenues. So we applied calculation similar to <span class="math inline">\(AC\)</span></p>
<pre class="r"><code>CLV.rc &lt;- 0.10 * total_daily_revenues * 365 / nrow(customer)</code></pre>
<p>Now, let’s focus on recurring revenues. First, we thought about estimating the recurring revenues by the average purchase by customer. But we figured that there were significant varation between the baskets of different customers. So we tried to apply the same reasoning at a customer level by estimating future purchases by past purchasing behaviour. But that does not account for the fact that the average amount bought in previous periods is a poor estimator future purchases. Indeed, using such model a user that has never bought anything will never buy anything, so he has inevitaly a negative CLV which should not always be the case.</p>
<p>So, in the end we chose to build a linear model to estimate how much a customer is likely to buy in october based on his purchasing behaviour of the previous months.</p>
<p>First, let’s build tables containing information of past purchases, by customer and by month:</p>
<pre class="r"><code>customerID.all &lt;- data_frame(CustomerID=customer$CustomerID)
tx.all$Month = format(tx.all$Date, &quot;%m&quot;)
columns &lt;- c(&#39;05&#39;, &#39;06&#39;, &#39;07&#39;, &#39;08&#39;, &#39;09&#39;, &#39;10&#39;)
monthly.tx.all &lt;- customerID.all %&gt;%
  left_join(tx.all, by = &quot;CustomerID&quot;) %&gt;%
  spread(Month, Value) %&gt;%
  select(-c(X:ProductID)) %&gt;%
  mutate_at(.vars = columns, funs(replace_na(.,0))) %&gt;%
  group_by(CustomerID) %&gt;%
  summarise_at(.vars = columns, funs(sum))
head(monthly.tx.all)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   CustomerID  `05`  `06`  `07`  `08`  `09`  `10`
##        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1          1  0        0     0  0        0     0
## 2          2  0        0     0  0        0     0
## 3          3  0        0     0  0        0     0
## 4          4  0        0     0  7.98     0     0
## 5          5  0        0     0  0        0     0
## 6          6  2.99     0     0  0        0     0</code></pre>
<pre class="r"><code>monthly.tx &lt;-
  tx.all %&gt;%
  spread(Month, Value) %&gt;%
  select(-c(X:Date, ProductID)) %&gt;%
  mutate_at(.vars = columns, funs(replace_na(.,0))) %&gt;%
  group_by(CustomerID) %&gt;%
  summarise_at(.vars = columns, funs(sum))
head(monthly.tx)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   CustomerID  `05`  `06`  `07`  `08`  `09`  `10`
##        &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1          4  0     0     0     7.98  0     0   
## 2          6  2.99  0     0     0     0     0   
## 3          8  0     0     9.98  4.99  2.99  9.99
## 4          9  0     0     2.99  0     4.99  0   
## 5         11  0     2.99  0     0     0     0   
## 6         13  0     0     0     4.99  0     0</code></pre>
<p>We comes the estimation of the recurring revenues of each customer:</p>
<pre class="r"><code>set.seed(11)

# select the indexes of the rows in the training set
train.index &lt;- createDataPartition(
  monthly.tx.all$`10`,
  p = .9,
  list = FALSE,
  times = 1
  )

# split the data
train   &lt;- monthly.tx.all[ train.index,]
test    &lt;- monthly.tx.all[-train.index,]
train.y &lt;- train$`10`
test.y  &lt;- test$`10`

# build the model
# after trying different models we kept the linear model because it was more simple with very comparable results
# we decided to add an intercept variable to account for the fact that a user who never bought anything might start buying
# This has a HUGE impact on the final result:
#     with intercept, a customer who as never bought as a CLV of 2.5
#     without intercept, a customer who as never bought as a CLV of -5.5
# The answer
model.revenue &lt;- lm(`10`~. - CustomerID, data=train)

# check the model
summary(model.revenue)</code></pre>
<pre><code>## 
## Call:
## lm(formula = `10` ~ . - CustomerID, data = train)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -17.49  -0.55  -0.45  -0.45 102.94 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   0.4505     0.0762    5.91  3.7e-09 ***
## `05`          0.0697     0.0117    5.96  2.7e-09 ***
## `06`          0.0347     0.0145    2.39   0.0169 *  
## `07`          0.0363     0.0136    2.66   0.0078 ** 
## `08`          0.0348     0.0157    2.22   0.0267 *  
## `09`          0.1634     0.0148   11.04  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.77 on 4494 degrees of freedom
## Multiple R-squared:  0.0417, Adjusted R-squared:  0.0406 
## F-statistic: 39.1 on 5 and 4494 DF,  p-value: &lt;2e-16</code></pre>
<pre class="r"><code># check the performance of the model
train.pred &lt;- predict(model.revenue, train)
test.pred  &lt;- predict(model.revenue, test)
sprintf(&quot;Average absolute error by customer (on training set): $%.2f&quot;, mean(abs(train.y-train.pred)))</code></pre>
<pre><code>## [1] &quot;Average absolute error by customer (on training set): $1.32&quot;</code></pre>
<pre class="r"><code>sprintf(&quot;Average absolute error by customer (on testing set): $%.2f&quot;, mean(abs(test.y-test.pred)))</code></pre>
<pre><code>## [1] &quot;Average absolute error by customer (on testing set): $1.05&quot;</code></pre>
<p>Not surprisingly, the results aren’t incredible, but we wouldn’t study Customer Analytcis if it were possible to perfectly predict what a customer will buy in the future.</p>
<p>Still, it is a better estimator of what’s he is going to buy than the average of what he bought the past months (see results below). And our model is surely more performant to estimate what our customer will keep buying in the months after October.</p>
<pre class="r"><code>print(mean(abs(test.y-rowMeans(test[,-c(1,7)]))))</code></pre>
<pre><code>## [1] 1.208</code></pre>
<p><strong>Calculation of CLV</strong></p>
<p>Now that we have estimated all parameters:</p>
<pre class="r"><code>CLV.const = data_frame(AC=CLV.AC, rc=CLV.rc, r=CLV.r, T=CLV.T, d=CLV.d)
CLV.const</code></pre>
<pre><code>## # A tibble: 1 x 5
##      AC    rc     r     T     d
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  3.84  1.10 0.389  2.44   0.1</code></pre>
<p>We can create the CLV function:</p>
<pre class="r"><code>CLV &lt;- function (CLV.const, model, id) {
  df_id &lt;- data_frame(CustomerID=id)
  model.input &lt;- df_id %&gt;% left_join(monthly.tx.all, by = &quot;CustomerID&quot;)
  # Period of time to convert revenue to (annual) recurring revenue
  rr &lt;- 12 * predict(model, model.input)

  # Customer value
  AC &lt;- CLV.const$AC       # Customer acquisition costs
  rc &lt;- CLV.const$rc       # Recurring cost
  m  &lt;- rr - CLV.const$rc  # Customer recurring contribution margin
  r  &lt;- CLV.const$r        # Retention probability for the customer
  t  &lt;- CLV.const$T        # Number of years &#39;out&#39; to estimate
  d  &lt;- CLV.const$d        # Discount rate (Cost of Capital)

  # print(cbind(AC, rc, m, r, t, d))

  clv &lt;- -AC
  for(i in 0:t) {
    clv &lt;- clv+((r^i)*m/(1+d)^i)
  }
  return(clv)
}</code></pre>
<p>And calculate le clv for every customer:</p>
<pre class="r"><code>customer.active &lt;- customer.active %&gt;% mutate(CLV = CLV(CLV.const, model.revenue, CustomerID))
summary(customer.active)</code></pre>
<pre><code>##    CustomerID   CustomerType Registrationdate     Sex           Age      
##  Min.   :   1   1:1225       Min.   :2016-07-01   0:2815   Min.   : 6.0  
##  1st Qu.:1252   2:1144       1st Qu.:2016-12-07   1:1902   1st Qu.:18.0  
##  Median :2506   3:1069       Median :2017-12-16            Median :27.0  
##  Mean   :2502   4:1279       Mean   :2017-08-10            Mean   :27.6  
##  3rd Qu.:3751                3rd Qu.:2018-03-01            3rd Qu.:33.0  
##  Max.   :5000                Max.   :2018-04-30            Max.   :80.0  
##  fallbonus Income   Age_category   Experience       Pokestops    
##  0:3771    1:1571   6-17 :1172   Min.   :  1767   Min.   : 10.0  
##  1: 946    2:1509   18-23: 598   1st Qu.: 14127   1st Qu.: 52.0  
##            3:1637   24-35:2097   Median : 22257   Median : 80.0  
##                     36-50: 616   Mean   : 25343   Mean   : 87.4  
##                     &gt;51  : 234   3rd Qu.: 32654   3rd Qu.:116.0  
##                                  Max.   :142475   Max.   :306.0  
##       Gyms           Raids          Social         Pokemons  
##  Min.   :  2.0   Min.   : 0.0   Min.   : 0.00   Min.   :  4  
##  1st Qu.: 23.0   1st Qu.: 0.0   1st Qu.: 1.00   1st Qu.: 56  
##  Median : 37.0   Median : 1.0   Median : 3.00   Median : 91  
##  Mean   : 41.8   Mean   : 4.1   Mean   : 6.48   Mean   :104  
##  3rd Qu.: 56.0   3rd Qu.: 6.0   3rd Qu.: 7.00   3rd Qu.:137  
##  Max.   :173.0   Max.   :67.0   Max.   :68.00   Max.   :508  
##     Distance         Duration       Recency      Frequency    
##  Min.   :  0.45   Min.   :  12   Min.   :  0   Min.   :0.000  
##  1st Qu.:  7.66   1st Qu.: 128   1st Qu.:118   1st Qu.:0.000  
##  Median : 13.93   Median : 219   Median :183   Median :0.000  
##  Mean   : 19.94   Mean   : 367   Mean   :148   Mean   :0.655  
##  3rd Qu.: 25.88   3rd Qu.: 400   3rd Qu.:183   3rd Qu.:1.000  
##  Max.   :129.14   Max.   :3344   Max.   :183   Max.   :8.000  
##     Monetary           CLV       
##  Min.   :  0.00   Min.   :  2.5  
##  1st Qu.:  0.00   1st Qu.:  2.5  
##  Median :  0.00   Median :  2.5  
##  Mean   :  5.80   Mean   :  8.4  
##  3rd Qu.:  4.99   3rd Qu.:  6.2  
##  Max.   :207.98   Max.   :353.3</code></pre>
</div>
<div id="demographic-analysis-profiling" class="section level3">
<h3>Demographic Analysis &amp; Profiling</h3>
<p>We will sketch general profiles of the active customers.</p>
<p>First, let’s have a look at how gender of the players are dispatched among the playsers :</p>
<pre class="r"><code>ggplot(customer.active)+aes(x=Sex)+geom_bar()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>We can see that there are more male players overall.</p>
<p>Now, we will consider that the general profile of a player is a male and we’ll now have a look at how they are dispatched through age categories.</p>
<pre class="r"><code>ggplot(customer.active %&gt;% filter(Sex==0))+aes(x=Age_category)+geom_bar()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>We can see that there are much more players between 24-35 overall. Thus, most of the players are male between 24-35.</p>
<p>Now, we’ll comapre the income level of male players between 24-35 :</p>
<pre class="r"><code>ggplot(customer.active %&gt;% filter(Age_category == &quot;24-35&quot;, Sex == 0)) + aes(x=Income) + geom_bar()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Thus, we can see that the number of players is quite the same per income level. There is no significative difference. We can deduce that a general player can have any level of income.</p>
<p>Thus, if we take into account the total number of players per demographic metrics, the profile of a general player would be a male between 24-35 and with any income level.</p>
<p>Now, let’s add in our reasonning the type of player with the general demographic profile we found.</p>
<pre class="r"><code>ggplot(customer.active %&gt;% filter(Age_category == &quot;24-35&quot;, Sex == 0)) +aes(x=Age_category,fill=as.factor(CustomerType))+geom_bar()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>Once again, we can see no significative difference between the customer type, even if the “Catchers” are the most numerous. Thus, we will consider that these players can be of any type.</p>
<p>Now, let’s add in our reasonning the financial value using Monetary and Frequency for the demographic profile we chose.</p>
<pre class="r"><code>customer.active %&gt;% filter(Age_category == &quot;24-35&quot;, Sex == 0) %&gt;% summarise(mean(Monetary),mean(Frequency),mean(CLV))</code></pre>
<pre><code>##   mean(Monetary) mean(Frequency) mean(CLV)
## 1          6.129          0.6526     8.492</code></pre>
<p>Thus, we can complete the general profile by saying that can the general profile is a player : - male between 24-35 - spending on average 6.13 with a frequency of 0.61 on the period.</p>
</div>
</div>
<div id="assignment-ii-lifecycle-grids" class="section level1">
<h1>Assignment II, Lifecycle grids:</h1>
<p>In life cycle grids, we are focusing on the R &amp; F of RFM. In other words, in frequent and recent purchases because frequency affects client’s lifetime value and recency affects retention. The purpose therefore is to provide a target offer to specific segments or customers.</p>
<div id="a-small-look-at-r-f-distributions" class="section level3">
<h3>A small look at R &amp; F distributions</h3>
<p><em>Note: the maximum of customer registration date is 30-04-2028 so we are sure that customer.active data doesn’t contain customers that could have registered in the fall period…</em></p>
<pre class="r"><code>#Initialisation: combining overall transactions with customer info
customer.LCG &lt;- tx.all %&gt;% select(-X) %&gt;% inner_join(customer.active)</code></pre>
<pre><code>## Joining, by = &quot;CustomerID&quot;</code></pre>
<pre class="r"><code>summary(customer.LCG)</code></pre>
<pre><code>##     TransID          Date              CustomerID     ProductID   
##  Min.   :   1   Min.   :2018-05-02   Min.   :   4   Min.   :1.00  
##  1st Qu.: 387   1st Qu.:2018-06-12   1st Qu.:1380   1st Qu.:1.00  
##  Median : 773   Median :2018-07-22   Median :2570   Median :2.00  
##  Mean   : 925   Mean   :2018-07-25   Mean   :2554   Mean   :2.08  
##  3rd Qu.:1459   3rd Qu.:2018-09-07   3rd Qu.:3766   3rd Qu.:3.00  
##  Max.   :2231   Max.   :2018-10-31   Max.   :4999   Max.   :5.00  
##      Value          Month           CustomerType Registrationdate    
##  Min.   : 2.99   Length:3089        1:702        Min.   :2016-07-01  
##  1st Qu.: 2.99   Class :character   2:584        1st Qu.:2016-11-27  
##  Median : 4.99   Mode  :character   3:934        Median :2017-11-20  
##  Mean   : 8.86                      4:869        Mean   :2017-08-01  
##  3rd Qu.: 9.99                                   3rd Qu.:2018-02-27  
##  Max.   :99.00                                   Max.   :2018-04-30  
##  Sex           Age       fallbonus Income   Age_category   Experience    
##  0:1873   Min.   : 6.0   0:2357    1:1079   6-17 : 754   Min.   :  1767  
##  1:1216   1st Qu.:18.0   1: 732    2: 937   18-23: 405   1st Qu.: 19652  
##           Median :27.0             3:1073   24-35:1354   Median : 28476  
##           Mean   :27.7                      36-50: 417   Mean   : 32184  
##           3rd Qu.:34.0                      &gt;51  : 159   3rd Qu.: 41230  
##           Max.   :80.0                                   Max.   :142475  
##    Pokestops        Gyms           Raids           Social     
##  Min.   : 10   Min.   :  3.0   Min.   : 0.00   Min.   : 0.00  
##  1st Qu.: 72   1st Qu.: 32.0   1st Qu.: 0.00   1st Qu.: 2.00  
##  Median :103   Median : 48.0   Median : 2.00   Median : 4.00  
##  Mean   :107   Mean   : 52.4   Mean   : 5.93   Mean   : 9.48  
##  3rd Qu.:136   3rd Qu.: 68.0   3rd Qu.: 9.00   3rd Qu.:12.00  
##  Max.   :306   Max.   :173.0   Max.   :67.00   Max.   :68.00  
##     Pokemons      Distance         Duration       Recency     
##  Min.   :  4   Min.   :  0.76   Min.   :  12   Min.   :  0.0  
##  1st Qu.: 77   1st Qu.:  9.71   1st Qu.: 159   1st Qu.: 20.0  
##  Median :114   Median : 16.90   Median : 277   Median : 56.0  
##  Mean   :127   Mean   : 22.18   Mean   : 524   Mean   : 66.6  
##  3rd Qu.:162   3rd Qu.: 27.53   3rd Qu.: 640   3rd Qu.:107.0  
##  Max.   :508   Max.   :129.14   Max.   :3344   Max.   :182.0  
##    Frequency       Monetary           CLV       
##  Min.   :1.00   Min.   :  2.99   Min.   :  4.4  
##  1st Qu.:1.00   1st Qu.:  7.98   1st Qu.:  6.4  
##  Median :2.00   Median : 12.98   Median : 14.9  
##  Mean   :2.37   Mean   : 20.85   Mean   : 23.4  
##  3rd Qu.:3.00   3rd Qu.: 27.96   3rd Qu.: 26.3  
##  Max.   :8.00   Max.   :207.98   Max.   :353.3</code></pre>
<pre class="r"><code># Frequency distribution
ggplot(customer.LCG)+aes(x=Frequency)+geom_bar()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<pre class="r"><code>#Recency Distribution (by days)
ggplot(customer.LCG)+aes(x=Recency)+geom_bar()</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="life-cycle-grids" class="section level3">
<h3>Life Cycle grids</h3>
<div id="introduction" class="section level4">
<h4>Introduction</h4>
<p>Let’s do now life cycle grids. In this part, we decided to consider frequency one by one until customers buy more that 5 products (because the gap between 1 and 2 products cannot be equally considered to the one between 5 and 6 products bought).</p>
<p>We use the ‘same’ principle to split the recency. More specifically, we decided segment them - regarding Niantic purposes - using relevant time periods:</p>
<ul>
<li>0-6 days &amp; 7-13: customers that can be considered as very frequent buyers</li>
<li>14-30 : customers that bought recently (during fall period but seems to have slowed down their use of their use of package to play)</li>
<li>31-50: customers that haven’t bought for a quite long period and that could we should focus on to reengage</li>
<li>51-85: customers that stopped to buy after the summer period - we should especially look at those ones to improve the marketing strategy purpose between summer and fall periods</li>
<li><blockquote>
<p>85: Finally, customers that can be considers as long-time buyers or those who follow the Pokemon Go trend of the summer but who were not really interested to evolve rapidly with Pokemon’s packages</p>
</blockquote></li>
</ul>
<pre class="r"><code>#Creation of Grids
customer.LCG &lt;- customer.LCG %&gt;%
  mutate(segm.freq=ifelse(Frequency == 1, &#39;1&#39;,
                          ifelse(Frequency == 2, &#39;2&#39;,
                                 ifelse(Frequency == 3, &#39;3&#39;,
                                      ifelse(Frequency == 4, &#39;4&#39;,
                                             ifelse(Frequency == 5,&#39;5&#39;,&#39;&gt;5&#39;)))))) %&gt;%
  mutate(segm.rec=ifelse(between(Recency,0,6), &#39;0-6 days&#39;,
                          ifelse(between(Recency,7,13), &#39;7-13 days&#39;, 
                                  ifelse(between(Recency, 14,30), &#39;14-30 days&#39;,
                                         ifelse(between(Recency,31,50), &#39;31-50 days&#39;,
                                               ifelse(between(Recency,51,85), &#39;51-85 days&#39;, &#39;&gt;85 days&#39;))))))

# spliting into discrete groups with levels to make &amp; identify grids later on
customer.LCG$segm.freq &lt;- factor(customer.LCG$segm.freq, levels=c(&#39;&gt;5&#39;,&#39;5&#39;,&#39;4&#39;,&#39;3&#39;,&#39;2&#39;,&#39;1&#39;))
customer.LCG$segm.rec &lt;- factor(customer.LCG$segm.rec, levels=c(&#39;&gt;85 days&#39;,&#39;51-85 days&#39;,&#39;31-50 days&#39;,&#39;14-30 days&#39;,&#39;7-13 days&#39;,&#39;0-6 days&#39;))

summary(customer.LCG)</code></pre>
<pre><code>##     TransID          Date              CustomerID     ProductID   
##  Min.   :   1   Min.   :2018-05-02   Min.   :   4   Min.   :1.00  
##  1st Qu.: 387   1st Qu.:2018-06-12   1st Qu.:1380   1st Qu.:1.00  
##  Median : 773   Median :2018-07-22   Median :2570   Median :2.00  
##  Mean   : 925   Mean   :2018-07-25   Mean   :2554   Mean   :2.08  
##  3rd Qu.:1459   3rd Qu.:2018-09-07   3rd Qu.:3766   3rd Qu.:3.00  
##  Max.   :2231   Max.   :2018-10-31   Max.   :4999   Max.   :5.00  
##      Value          Month           CustomerType Registrationdate    
##  Min.   : 2.99   Length:3089        1:702        Min.   :2016-07-01  
##  1st Qu.: 2.99   Class :character   2:584        1st Qu.:2016-11-27  
##  Median : 4.99   Mode  :character   3:934        Median :2017-11-20  
##  Mean   : 8.86                      4:869        Mean   :2017-08-01  
##  3rd Qu.: 9.99                                   3rd Qu.:2018-02-27  
##  Max.   :99.00                                   Max.   :2018-04-30  
##  Sex           Age       fallbonus Income   Age_category   Experience    
##  0:1873   Min.   : 6.0   0:2357    1:1079   6-17 : 754   Min.   :  1767  
##  1:1216   1st Qu.:18.0   1: 732    2: 937   18-23: 405   1st Qu.: 19652  
##           Median :27.0             3:1073   24-35:1354   Median : 28476  
##           Mean   :27.7                      36-50: 417   Mean   : 32184  
##           3rd Qu.:34.0                      &gt;51  : 159   3rd Qu.: 41230  
##           Max.   :80.0                                   Max.   :142475  
##    Pokestops        Gyms           Raids           Social     
##  Min.   : 10   Min.   :  3.0   Min.   : 0.00   Min.   : 0.00  
##  1st Qu.: 72   1st Qu.: 32.0   1st Qu.: 0.00   1st Qu.: 2.00  
##  Median :103   Median : 48.0   Median : 2.00   Median : 4.00  
##  Mean   :107   Mean   : 52.4   Mean   : 5.93   Mean   : 9.48  
##  3rd Qu.:136   3rd Qu.: 68.0   3rd Qu.: 9.00   3rd Qu.:12.00  
##  Max.   :306   Max.   :173.0   Max.   :67.00   Max.   :68.00  
##     Pokemons      Distance         Duration       Recency     
##  Min.   :  4   Min.   :  0.76   Min.   :  12   Min.   :  0.0  
##  1st Qu.: 77   1st Qu.:  9.71   1st Qu.: 159   1st Qu.: 20.0  
##  Median :114   Median : 16.90   Median : 277   Median : 56.0  
##  Mean   :127   Mean   : 22.18   Mean   : 524   Mean   : 66.6  
##  3rd Qu.:162   3rd Qu.: 27.53   3rd Qu.: 640   3rd Qu.:107.0  
##  Max.   :508   Max.   :129.14   Max.   :3344   Max.   :182.0  
##    Frequency       Monetary           CLV        segm.freq
##  Min.   :1.00   Min.   :  2.99   Min.   :  4.4   &gt;5:  45  
##  1st Qu.:1.00   1st Qu.:  7.98   1st Qu.:  6.4   5 : 155  
##  Median :2.00   Median : 12.98   Median : 14.9   4 : 296  
##  Mean   :2.37   Mean   : 20.85   Mean   : 23.4   3 : 738  
##  3rd Qu.:3.00   3rd Qu.: 27.96   3rd Qu.: 26.3   2 :1004  
##  Max.   :8.00   Max.   :207.98   Max.   :353.3   1 : 851  
##        segm.rec   
##  &gt;85 days  :1085  
##  51-85 days: 604  
##  31-50 days: 416  
##  14-30 days: 364  
##  7-13 days : 249  
##  0-6 days  : 371</code></pre>
<p>We will first have a look at the volume of transactions regarding the period (recency) and the frequency.</p>
</div>
<div id="approach-in-volume-of-transactions" class="section level4">
<h4>Approach in Volume of transactions</h4>
<pre class="r"><code># General Overview
lcg.gen &lt;- customer.LCG %&gt;%
  group_by(segm.rec, segm.freq) %&gt;%
  summarise(quantity=n()) %&gt;%
  mutate(client=&#39;client&#39;) %&gt;%
  ungroup()

#let&#39;s add sub-categories to better distinguish customer profiles in our grids
lcg.gen &lt;- lcg.gen %&gt;% mutate(rec.type = ifelse(segm.rec %in% c(&#39;&gt;85 days&#39;, &#39;51-85 days&#39;, &#39;31-50 days&#39;), &#39;not recent&#39;, &#39;recent&#39;),
 freq.type = ifelse(segm.freq %in% c(&#39;&gt;5&#39;, &#39;5&#39;, &#39;4&#39;), &#39;frequent&#39;, &#39;infrequent&#39;),
 customer.bh = interaction(rec.type, freq.type))


ggplot(lcg.gen, aes(x=client, y=quantity, fill=customer.bh))+
  theme_bw() +
  theme(panel.grid = element_blank())+
  geom_bar(stat=&#39;identity&#39;, alpha=0.7) +
  geom_rect(aes(fill = customer.bh), xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf, alpha = 0.1) +
  geom_text(aes(y=max(quantity)/2, label=quantity), size=4) +
  facet_grid(segm.freq ~ segm.rec)+
  ggtitle(&quot;LifeCycle Grids: Number of transactions and underlying categorisation&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<pre class="r"><code>lcg.bonus_type &lt;- customer.LCG %&gt;%
  group_by(segm.rec, segm.freq,CustomerType,fallbonus) %&gt;%
  summarise(quantity=n()) %&gt;%
  ungroup()

ggplot(lcg.bonus_type, aes(x=CustomerType, y=quantity, fill=fallbonus))+
  theme_bw() +
  scale_fill_brewer(palette = &#39;Set1&#39;)+
  theme(panel.grid = element_blank())+
  geom_bar(stat=&#39;identity&#39;, alpha=0.6) +
  facet_grid(segm.freq ~ segm.rec)+
  ggtitle(&quot;LifeCycle Grids: Number of transactions by CustomerType and fallbonus&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
<div id="approach-in-monetary-value-for-transactions" class="section level4">
<h4>Approach in Monetary Value for transactions</h4>
<p>The monetary value is very interesting to improve the marketing strategy.</p>
<p>For a this approach we will have to consider CAC and CLV we previsouly calculated on Assignment 1 for each customer (note that we already have it in the customer.active dataset that we then merged with tx.all to get customer.LCG) Note that the CAC is always the same (this is the assumption we made in the first assignment because we don’t have enough marketing financials information).</p>
<pre class="r"><code>lcg.clv &lt;- customer.LCG %&gt;%
  mutate(cac=CLV.const$AC) %&gt;% 
  group_by(segm.rec, segm.freq) %&gt;%
  summarise(quantity=n(),clv_tot=round(sum(CLV)),clv_avg=round(mean(CLV)),cac_tot=round(sum(cac)),cac_avg=round(mean(cac))) %&gt;%
  ungroup()

lcg.clv &lt;- melt(lcg.clv, id.vars=c(&#39;segm.rec&#39;, &#39;segm.freq&#39;, &#39;quantity&#39;))

ggplot(lcg.clv[lcg.clv$variable %in% c(&#39;clv_tot&#39;, &#39;cac_tot&#39;), ], aes(x=variable, y=value, fill=variable)) +
  theme_bw() +
  theme(panel.grid = element_blank())+
  geom_bar(stat=&#39;identity&#39;, alpha=0.6, aes(width=quantity/max(quantity))) +
  geom_text(aes(y=value, label=value), size=3) +
  facet_grid(segm.freq ~ segm.rec) +
  ggtitle(&quot;LifeCycle Grids - CAC vs CLV Total&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<pre class="r"><code>ggplot(lcg.clv[lcg.clv$variable %in% c(&#39;clv_avg&#39;, &#39;cac_avg&#39;), ], aes(x=variable, y=value, fill=variable)) +
  theme_bw() +
  theme(panel.grid = element_blank())+
  geom_bar(stat=&#39;identity&#39;, alpha=0.6, aes(width=quantity/max(quantity))) +
  geom_text(aes(y=value, label=value), size=3) +
  facet_grid(segm.freq ~ segm.rec) +
  ggtitle(&quot;LifeCycle Grids - CAC vs CLV Average&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-34-2.png" width="672" /></p>
<p>Note that the width of bars depends on the quantity (i.e: the number of customers in this sub-category)</p>
</div>
</div>
</div>
<div id="assigment-iii-churn-analysis" class="section level1">
<h1>Assigment III, Churn analysis</h1>
<p>In this assignent we want to understand more what are the variables that have an impact on churn to be able to predict churn better.</p>
<p>First we need to be clear about churn definition. The definition provided in the assignment for churn is a customer who did not perform any transaction in fall 2018.</p>
<blockquote>
<p>Remider: we working on the “active” basetable composer of all customer that played at least once during the summer, regardless wether they made transactions in summer or not</p>
</blockquote>
<pre class="r"><code>customerID.active.fall &lt;- sessions.fall %&gt;%
  group_by(CustomerID) %&gt;%
  distinct(CustomerID) %&gt;%
  select(CustomerID)

customer.active &lt;- customer.active %&gt;%
  mutate(Churned = ! CustomerID %in% customerID.active.fall$CustomerID)</code></pre>
<p>Now let’s build different models and compare them to find the best one. We will keep the most parsimonious one with an AIC comparable to the full model.</p>
<p>First let’s build the full model to have a point of reference of what’s a good AIC:</p>
<pre class="r"><code>model.churn.full &lt;- glm(Churned ~ .,
                   family = binomial(link=&#39;logit&#39;),
                   data = customer.active)

summary(model.churn.full)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Churned ~ ., family = binomial(link = &quot;logit&quot;), 
##     data = customer.active)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.560  -0.797  -0.506   0.910   2.984  
## 
## Coefficients:
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)        9.04e+00   3.25e+00    2.78  0.00546 ** 
## CustomerID         9.06e-06   2.50e-05    0.36  0.71653    
## CustomerType2     -6.18e-02   1.44e-01   -0.43  0.66705    
## CustomerType3     -1.71e+00   2.22e-01   -7.67  1.7e-14 ***
## CustomerType4     -1.82e-01   1.92e-01   -0.95  0.34304    
## Registrationdate  -5.03e-04   1.84e-04   -2.73  0.00634 ** 
## Sex1              -2.57e-04   7.29e-02    0.00  0.99718    
## Age               -1.82e-02   9.72e-03   -1.88  0.06048 .  
## fallbonus1        -1.21e-01   9.23e-02   -1.31  0.18988    
## Income2           -3.82e-02   8.80e-02   -0.43  0.66420    
## Income3           -1.44e-01   8.68e-02   -1.66  0.09716 .  
## Age_category18-23  9.20e-02   1.51e-01    0.61  0.54095    
## Age_category24-35  3.48e-01   1.94e-01    1.79  0.07381 .  
## Age_category36-50  4.45e-01   3.25e-01    1.37  0.17039    
## Age_category&gt;51    9.60e-01   5.38e-01    1.78  0.07448 .  
## Experience         9.10e-02   5.86e-02    1.55  0.12045    
## Pokestops         -4.58e+00   2.93e+00   -1.56  0.11786    
## Gyms              -1.82e+01   1.17e+01   -1.55  0.12036    
## Raids             -9.10e+01   5.86e+01   -1.55  0.12048    
## Social            -1.82e+01   1.17e+01   -1.55  0.12087    
## Pokemons          -4.54e+00   2.93e+00   -1.55  0.12095    
## Distance          -9.10e+00   5.86e+00   -1.55  0.12034    
## Duration           1.10e-03   3.52e-04    3.11  0.00185 ** 
## Recency            6.46e-03   1.70e-03    3.79  0.00015 ***
## Frequency          1.38e-01   9.56e-02    1.44  0.14863    
## Monetary           3.56e-03   5.90e-03    0.60  0.54553    
## CLV                4.22e-04   4.23e-03    0.10  0.92064    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 5534.8  on 4716  degrees of freedom
## Residual deviance: 4731.5  on 4690  degrees of freedom
## AIC: 4785
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>So we want a model with an AIC as close as possible from 1500.</p>
<p>First, let’s build our first model only based on the fall bonus:</p>
<pre class="r"><code>model.churn.1 &lt;- glm(Churned ~ fallbonus -1,
                     family = binomial(link=&#39;logit&#39;),
                     data = customer.active)
summary(model.churn.1)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Churned ~ fallbonus - 1, family = binomial(link = &quot;logit&quot;), 
##     data = customer.active)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -0.812  -0.812  -0.812   1.593   1.682  
## 
## Coefficients:
##            Estimate Std. Error z value Pr(&gt;|z|)    
## fallbonus0  -0.9390     0.0362   -25.9   &lt;2e-16 ***
## fallbonus1  -1.1356     0.0758   -15.0   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 6539.2  on 4717  degrees of freedom
## Residual deviance: 5529.2  on 4715  degrees of freedom
## AIC: 5533
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The fall bonus has indeed a significant impact on churn but it not be the only variable to consider to predict churn because the AIC is quite far from the full model’s AIC.</p>
<p>Let’s add the Recency criterium as one can imagine that a player who just bought an item has lower chances to churn:</p>
<pre class="r"><code>model.churn.2 &lt;- glm(Churned ~ fallbonus + Recency -1,
                     family = binomial(link=&#39;logit&#39;),
                     data = customer.active)
summary(model.churn.2)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Churned ~ fallbonus + Recency - 1, family = binomial(link = &quot;logit&quot;), 
##     data = customer.active)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -0.882  -0.882  -0.759   1.505   2.123  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## fallbonus0 -1.985554   0.116462  -17.05   &lt;2e-16 ***
## fallbonus1 -2.142787   0.132954  -16.12   &lt;2e-16 ***
## Recency     0.006787   0.000697    9.73   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 6539.2  on 4717  degrees of freedom
## Residual deviance: 5421.2  on 4714  degrees of freedom
## AIC: 5427
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>Now we might want to add the Experience variable as a user that already played a lot is less likely to stop due to sunk cost fallacy:</p>
<pre class="r"><code>model.churn.3 &lt;- glm(Churned ~ fallbonus + Recency + Experience -1,
                   family = binomial(link=&#39;logit&#39;),
                   data = customer.active)

summary(model.churn.3)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Churned ~ fallbonus + Recency + Experience - 1, 
##     family = binomial(link = &quot;logit&quot;), data = customer.active)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.307  -0.841  -0.559   1.061   3.065  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## fallbonus0  1.18e-02   1.49e-01    0.08     0.94    
## fallbonus1 -1.16e-01   1.64e-01   -0.71     0.48    
## Recency     3.42e-03   7.38e-04    4.64  3.5e-06 ***
## Experience -6.82e-05   3.47e-06  -19.68  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 6539.2  on 4717  degrees of freedom
## Residual deviance: 4884.6  on 4713  degrees of freedom
## AIC: 4893
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>This last model seems quite good as we have almost the same AIC criterion as the full model, which means that this model contains almost the same amount of information as the best one in the family of the logistic regression models.</p>
<p>Thus, we may conclude that the fall bonus, the recency of buying and the experience of the player are the three variables that explains most of the predictable churn.</p>
<p>To avoid churning in the future, we have build marketing strategies that will maximise the experience gain by the players and minimise their recency.</p>
<p>Thus, we think about giving bonus of experience for the players during the 15 days following the purchase a product. This will give an incentive to the players to keep playing and purchasing, so it will decrease recency.</p>
<p>To maximise the experience of the player, the idea is to give bonus of experience for special quests achievements &amp; challenges. We do not want to decrease the value of experience, it has to be a fair reward. Thus, we will propose for instance bonus of experience to the players who catched 10 pokemons of type Water during five days.</p>
<div id="calculation-for-crm-recommendation" class="section level3">
<h3>Calculation for CRM recommendation</h3>
<pre class="r"><code>customer.active %&gt;% group_by(CustomerType) %&gt;% summarise(mean(Monetary),mean(Frequency),mean(CLV))</code></pre>
<pre><code>## # A tibble: 4 x 4
##   CustomerType `mean(Monetary)` `mean(Frequency)` `mean(CLV)`
##   &lt;fct&gt;                   &lt;dbl&gt;             &lt;dbl&gt;       &lt;dbl&gt;
## 1 1                        4.55             0.573        7.15
## 2 2                        3.86             0.510        6.66
## 3 3                        9.68             0.874       11.7 
## 4 4                        5.48             0.679        8.25</code></pre>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiUG9rZW1vbkdvIGN1c3RvbWVyIGFuYWx5dGljcyIKYXV0aG9yOiAnW0xlb25hcmQgSGVucmlxdWV6XShodHRwczovL2dpdGh1Yi5jb20vbGVvbmFyZC1oZW5yaXF1ZXovKSwgW0FkcmllbiBMZXF1aWxsZXJdKGh0dHBzOi8vZ2l0aHViLmNvbS9hZHJpZW5sZXF1aWxsZXIpICYgW0VkZHkgT2hheW9uXShodHRwczovL2dpdGh1Yi5jb20vRWRkb2hhNTUpJwpkYXRlOiAiYHIgU3lzLkRhdGUoKWAiCm91dHB1dDogaHRtbF9kb2N1bWVudAphbHdheXNfYWxsb3dfaHRtbDogeWVzCi0tLQoKYGBge3IgbWVzc2FnZT1GQUxTRSwgd2FybmluZz1GQUxTRSwgaW5jbHVkZT1GQUxTRX0KIyBPcHRpb25zCmtuaXRyOjpvcHRzX2NodW5rJHNldChjYWNoZSA9IFRSVUUsIHdhcm5pbmc9RkFMU0UpCm9wdGlvbnMoZGlnaXRzPTQpCgojIExpYnJhcmllcwpsaWJyYXJ5KGRwbHlyKQpsaWJyYXJ5KHRpZHlyKQpsaWJyYXJ5KGdncGxvdDIpCmxpYnJhcnkoY2FyZXQpCmxpYnJhcnkoeGdib29zdCkKbGlicmFyeShyZXNoYXBlMikKYGBgCgojIEFzc2lnbm1lbnQgSSwgQmFzZXRhYmxlCgojIyMgRGF0YSBpbXBvcnRhdGlvbiBhbmQgY2xlYW5pbmcKCjEpIEZpcnN0LCBsZXQncyBzdGFydCBieSByZWFkaW5nIHRoZSBjdXN0b21lcicgZGF0YToKYGBge3J9CiMgSW1wb3J0IGN1c3RvbWVycyBkYXRhCmN1c3RvbWVyIDwtIHJlYWQuY3N2KCJpbnB1dC9jdXN0b21lcmRhdGEuY3N2IiApCgojIENsZWFuIGRhdGEKY3VzdG9tZXIkUmVnaXN0cmF0aW9uZGF0ZSA8LSBhcy5EYXRlKGN1c3RvbWVyJFJlZ2lzdHJhdGlvbmRhdGUpCmN1c3RvbWVyJGZhbGxib251cyAgICAgICAgPC0gYXMuZmFjdG9yKGN1c3RvbWVyJGZhbGxib251cykKY3VzdG9tZXIkQ3VzdG9tZXJUeXBlICAgICA8LSBhcy5mYWN0b3IoY3VzdG9tZXIkQ3VzdG9tZXJUeXBlKQpjdXN0b21lciRTZXggICAgICAgICAgICAgIDwtIGFzLmZhY3RvcihjdXN0b21lciRTZXgpCmN1c3RvbWVyJEluY29tZSAgICAgICAgICAgPC0gYXMuZmFjdG9yKGN1c3RvbWVyJEluY29tZSkKCiNMZXQncyBjcmVhdGUgY2F0ZWdvcmllcyBvZiBBZ2UgKHRoYXQgY291bGQgYmUgcmVsZXZhbnQgZm9yIHRoZSByZXN0KSA6CmN1c3RvbWVyIDwtIGN1c3RvbWVyICU+JQogIG11dGF0ZShBZ2VfY2F0ZWdvcnk9CiAgICBpZmVsc2UoYmV0d2VlbihBZ2UsIDYsIDE3KSwgJzYtMTcnLAogICAgaWZlbHNlKGJldHdlZW4oQWdlLCAxOCwgMjMpLCAnMTgtMjMnLAogICAgaWZlbHNlKGJldHdlZW4oQWdlLCAyNCwgMzUpLCAnMjQtMzUnLAogICAgaWZlbHNlKGJldHdlZW4oQWdlLCAzNiwgNTApLCAnMzYtNTAnLCAnPjUxJwogICkpKSkpCmN1c3RvbWVyJEFnZV9jYXRlZ29yeSA8LSBmYWN0b3IoY3VzdG9tZXIkQWdlX2NhdGVnb3J5LCBsZXZlbHM9YygnNi0xNycsICcxOC0yMycsICcyNC0zNScsICczNi01MCcsICc+NTEnKSkKCiMgQW5kIGxldCdzIGNoZWNrIHdoYXQgd2UgaGF2ZQpzdW1tYXJ5KGN1c3RvbWVyKQpgYGAKCgoyKSBOb3cgbGV0J3MgY2hlY2sgdGhlIHRyYW5zYWN0aW9uczoKYGBge3J9CiMgSW1wb3J0IHRyYW5zYWN0aW9ucwp0eC5mYWxsICAgPC0gcmVhZC5jc3YoImlucHV0L2ZhbGxmaW50cnguY3N2IiAgICkKdHguc3VtbWVyIDwtIHJlYWQuY3N2KCJpbnB1dC9zdW1tZXJmaW50cnguY3N2IiApCgojIFdlIG5lZWQgdG8gYWRkIG1vbmV0YXJ5IHZhbHVlIGFuZCBjb252ZXJ0IHRoZSBkYXRlCiMgVGhpcyBpcyB0aGUgbGlzdCBvZiBwcmljZXMgZm9yIGVhY2ggUHJvZHVjdElECnByaWNlcyAgICA8LSBjKDIuOTksIDQuOTksIDkuOTksIDI1LCA5OSkKdHguZmFsbCAgIDwtIHR4LmZhbGwgICAlPiUgbXV0YXRlKFZhbHVlID0gcHJpY2VzW1Byb2R1Y3RJRF0sIERhdGUgPSBhcy5EYXRlKERhdGUpKQp0eC5zdW1tZXIgPC0gdHguc3VtbWVyICU+JSBtdXRhdGUoVmFsdWUgPSBwcmljZXNbUHJvZHVjdElEXSwgRGF0ZSA9IGFzLkRhdGUoRGF0ZSkpCgojIFRoZW4gd2UgY3JlYXRlIGEgZGF0YSBmcmFtZSB3aXRoIGFsbCBkYXRhCnR4LmFsbCAgICA8LSB0eC5mYWxsICU+JSB1bmlvbih0eC5zdW1tZXIpCgojIEFuZCBsZXQncyBjaGVjayB3aGF0IHdlIGhhdmUKc3VtbWFyeSh0eC5hbGwpCmBgYAoKRm9yIGxhdGVyIHdlIG5lZWQgdG8ga2VlcCB0aGUgZGF0ZXMgb2YgYmVnaW5uaW5nIGFuZCBlbmRpbmcgb2YgdGhlIHBlcmlvZHM6CmBgYHtyfQojIFRoaXMgd2lsbCBjb3JyZXNwb25kIHRvIHRoZSBoaXN0b3J5IHBlcmlvZCB0byBidWlsZCB0aGUgbW9kZWxzCmZhbGwuYmVnaW4gICA8LSBtaW4odHguZmFsbCREYXRlKQpmYWxsLmVuZCAgICAgPC0gbWF4KHR4LmZhbGwkRGF0ZSkKCiMgVGhpcyB3aWxsIGNvcnJlc3BvbmQgdG8gdGhlIGZvcmVjYXN0IHBlcmlvZCB0byBidWlsZCBhbmQgZXZhbHVhdGUgdGhlIG1vZGVscwpzdW1tZXIuYmVnaW4gPC0gbWluKHR4LnN1bW1lciREYXRlKQpzdW1tZXIuZW5kICAgPC0gbWF4KHR4LnN1bW1lciREYXRlKQoKIyBUaGlzIHdpbGwgY29ycmVzcG9uZCB0byB0aGUgZW50aXJlIHBlcmlvZCB0byBidWlsZCB0aGUgZmluYWwgbW9kZWwKYWxsLmJlZ2luICAgIDwtIG1pbih0eC5hbGwkRGF0ZSkKYWxsLmVuZCAgICAgIDwtIG1heCh0eC5hbGwkRGF0ZSkKYGBgCgoKMykgQW5kIGZpbmFsbHkgdGhlIHNlc3Npb25zOgpgYGB7cn0KIyBJbXBvcnQgc2Vzc2lvbnMKc2Vzc2lvbnMuZmFsbCAgICAgICAgIDwtIHJlYWQuY3N2KCJpbnB1dC9mYWxsc2Vzc3RyeC5jc3YiICApCnNlc3Npb25zLnN1bW1lciAgICAgICA8LSByZWFkLmNzdigiaW5wdXQvc3VtbWVyc2Vzc3RyeC5jc3YiKQpzZXNzaW9ucy5mYWxsJERhdGUgICAgPC0gYXMuRGF0ZShzZXNzaW9ucy5mYWxsJERhdGUpCnNlc3Npb25zLnN1bW1lciREYXRlICA8LSBhcy5EYXRlKHNlc3Npb25zLnN1bW1lciREYXRlKQoKc2Vzc2lvbnMuYWxsICAgICAgICAgIDwtIHNlc3Npb25zLmZhbGwgJT4lIHVuaW9uKHNlc3Npb25zLnN1bW1lcikKYGBgCgojIyMgUkZNIEFuYWx5c2lzCgpUaGUgcG9pbnQgb2YgdGhpcyBwYXJ0IGlzIHRvIGNhbGN1bGF0ZSB0aGUgUkZNIGZvciBhbGwgYWN0aXZlIGN1c3RvbWVycy4KV2UgY291bGQgYmFzZSBvdXIgUkZNIGFuYWx5c2lzIGVpdGhlciBvbiBzZXNzaW9ucyBvciBvbiB0cmFuc2FjdGlvbnMuIFdlIG9wdGVkIGZvciBSRk0gYW5hbHlzaXMgYmFzZWQgb24gdHJhbnNhY3Rpb25zIGJlY2F1c2UgaXQgaXMgYSBiZXR0ZXIgcHJveHkgZm9yIG1vbmV0YXJ5IHZhbHVlIG9mIGEgY3VzdG9tZXIuCgpXZSBkZWZpbmVkOgoKKiAqKlJlY2VuY3kqKiBhcyB0aGUgbnVtYmVyIG9mIGRheXMgc2luY2UgbGFzdCB0cmFuc2FjdGlvbgoqICoqRnJlcXVlbmN5KiogYXMgdGhlIG51bWJlciBvZiB0cmFuc2FjdGlvbnMKKiAqKk1vbmV0YXJ5KiogdmFsdWUgYXMgdGhlIHRvdGFsIHZhbHVlIG9mIGFsbCBwcm9kdWN0cyBib3VnaHQgaW4gdGhlIHBlcmlvZAoKYGBge3J9CiMgQ2FsY3VsYXRlZCBSRk0gYmFzZWQgb24gYWxsIHRyYW5zYWN0aW9ucyAoc3VtbWVyIGFuZCBmYWxsKQojIGZvciBlYWNoIGN1c3RvbWVyICh3aG8gbWFkZSBhdCBsZWFzdCBvbmUgdHJhbnNhY3Rpb24pCmN1c3RvbWVyLlJGTSA8LSB0eC5hbGwgJT4lCiAgZ3JvdXBfYnkoQ3VzdG9tZXJJRCkgJT4lCiAgc3VtbWFyaXNlKFJlY2VuY3kgPSBhcy5udW1lcmljKGFsbC5lbmQtbWF4KERhdGUpKSwgRnJlcXVlbmN5ID0gbigpLCBNb25ldGFyeSA9IHN1bShWYWx1ZSkpCgpzdW1tYXJ5KGN1c3RvbWVyLlJGTSkKYGBgCkF0dGVudGlvbjogc2luY2UgdGhpcyBsaXN0IGlzIGJ1aWxkIGZyb20gYHR4LmFsbGAgaXQgd2lsbCBvbmx5IGNvbnRhaW4gY3VzdG9tZXJzIHRoYXQgbWFkZSAqKmF0IGxlYXN0IG9uZSB0cmFuc2FjdGlvbioqLgoKTm93IGxldCdzIGNyZWF0ZSBhIGxpc3Qgb2YgYWN0aXZlIGN1c3RvbWVyczoKYGBge3J9CiMgR2V0IGFsbCBjdXN0b21lcklEcyBvZiBwZW9wbGUgd2hvIHBsYXllZCBhdCBsZWFzdCBvbmNlIGR1cmluZyB0aGUgc3VtbWVyCmN1c3RvbWVySUQuYWN0aXZlIDwtIHNlc3Npb25zLnN1bW1lciAlPiUKICBzZWxlY3QoQ3VzdG9tZXJJRCkgJT4lCiAgZGlzdGluY3QoQ3VzdG9tZXJJRCkKYGBgCgpOb3cgd2UgaGF2ZSBlbm91Z2ggdG8gY3JlYXRlIGEgUkZNIHRhYmxlIG9mIGFjdGl2ZSBjdXN0b21lcnMgYnV0IHdlIG1pZ2h0IHdhbnQgb3RoZXIgaW5mb3JtYXRpb25zIG9uIHNlc3Npb25zIHBsYXllZC4gU28sIGxldCdzIGNyZWF0ZSBhIHRhYmxlIHRoYXQgc3VtbWFyaXNlIHRoZSBpbmZvcm1hdGlvbiBvZiB0aGUgc2Vzc2lvbnMgcGxheWVkIGJ5IGN1c3RvbWVyczoKCmBgYHtyfQpjdXN0b21lci5zdGF0cyA8LSBzZXNzaW9ucy5hbGwgJT4lCiAgZ3JvdXBfYnkoQ3VzdG9tZXJJRCkgJT4lCiAgc2VsZWN0KC1jKFgsIFBsYXlJRCwgRGF0ZSkpICU+JQogIHN1bW1hcmlzZV9hbGwoZnVucyhzdW0pKQoKc3VtbWFyeShjdXN0b21lci5zdGF0cykKYGBgCgpGaW5hbGx5LCB3ZSBqdXN0IG5lZWQgdG8gY29tYmluZSB0aGUgdGFibGVzIGJ1aWx0IHByZXZpb3VzbHkgdG8gZ2V0IG91ciBiYXNldGFibGU6CmBgYHtyfQojIEFkZCBhbGwgaW5mb3JtYXRpb25zIHRvIHRoZSB0YWJsZSB3aXRoIGFsbCBjdXN0b21lcnMKcmVjZW5jeS5tYXggPSBtYXgoY3VzdG9tZXIuUkZNJFJlY2VuY3kpICsgMQoKY3VzdG9tZXIgPC0gY3VzdG9tZXIgJT4lCiAgbGVmdF9qb2luKGN1c3RvbWVyLnN0YXRzLCBieSA9ICJDdXN0b21lcklEIikgJT4lCiAgbGVmdF9qb2luKGN1c3RvbWVyLlJGTSwgYnkgPSAnQ3VzdG9tZXJJRCcpICU+JQogIHNlbGVjdCgtWCkgJT4lCiAgIyBXZSBuZWVkIHRvIHJlcGxhY2Ugd2UgMCB0aGUgbWlzc2luZyB2YWx1ZXMgY29ycmVzcG9uZGluZyB0byBjdXN0b21lciB3aG8gbmV2ZXIgYm91Z2h0IGFueSBpdGVtCiAgbXV0YXRlKAogICAgUmVjZW5jeSA9IHJlcGxhY2VfbmEoUmVjZW5jeSwgbWF4KHJlY2VuY3kubWF4KSksCiAgICBGcmVxdWVuY3kgPSByZXBsYWNlX25hKEZyZXF1ZW5jeSwgMCksCiAgICBNb25ldGFyeSA9IHJlcGxhY2VfbmEoTW9uZXRhcnksIDApCiAgKQoKIyBGaWx0ZXIgb25seSBhY3RpdmUgY3VzdG9tZXJzCmN1c3RvbWVyLmFjdGl2ZSA8LSBjdXN0b21lciAlPiUgZmlsdGVyKEN1c3RvbWVySUQgJWluJSBjdXN0b21lcklELmFjdGl2ZSRDdXN0b21lcklEKQoKIyBmaW5hbCBiYXNldGFibGUKc3VtbWFyeShjdXN0b21lci5hY3RpdmUpCmBgYAoKIyMjIEN1c3RvbWVyIExpZmV0aW1lIFZhbHVlCgpDdXN0b21lciBMaWZldGltZSBWYWx1ZSAoQ0xWKSBpcyBnaXZlbiBieSB0aGUgZm9ybXVsYToKCiQkXHN1bV97dD0wfV57VH0gbSBcZnJhY3tyXnt0fX17KDErZClee3R9fS1BQyQkCgpJbiBvcmRlciB0byBjYWxjdWxhdGUgaXQgd2UgaGF2ZSA1IHBhcmFtZXRlcnMgdG8gZXN0aW1hdGU6CgoqICRkJDogRGlzY291bnQgcmF0ZSAoQ29zdCBvZiBDYXBpdGFsKQoqICRBQyQ6IEFjcXVpc2l0aW9uIGNvc3RzIChwZXIgY3VzdG9tZXIpCiogJHIkOiBSZXRlbnRpb24gcHJvYmFiaWxpdHkgZm9yIHRoZSBjdXN0b21lcgoqICRUJDogTnVtYmVyIG9mIHllYXJzICdvdXQnCiogJG0kOiBDdXN0b21lciByZWN1cnJpbmcgY29udHJpYnV0aW9uIG1hcmdpbiAod2hpY2ggaXMgZXF1YWwgdG8gcmVjdXJyaW5nIHJldmVudWVzIGxlc3MgcmVjdXJyaW5nIGNvc3RzKQoKTm93IGxldCdzIG1ha2UgKHJlYXNvbmFibGUpIGFzc3VtcHRpb25zIG9uIHRob3NlIHBhcmFtZXRlcnMuCkZpcnN0LCB3ZSBkZWNpZGVkIHRvIGVzdGltYXRlIGFsbCBwYXJhbWV0ZXJzIGV4Y2VwdGVkICRtJCBieSB2YWx1ZXMgY29tbW9uIHRvIGFsbCBjdXN0b21lcnMuIEZvciAkZCQgb3IgJFQkLCB3ZSBoYXZlIG5vIHJlYXNvbiB0byBjb25zaWRlciBhIGRpZmZlcmVudCBjb3N0IG9mIGNhcGl0YWwgb3IgbnVtYmVyIG9mIHllYXIgb3V0IGZvciBhIGN1c3RvbWVyIG9yIGFub3RoZXIuIEZvciAkQUMkIHdlIGhhdmUgbm8gaW5mb3JtYXRpb24gY29uY2VybmluZyBtYXJrZXRpbmcgb3BlcmF0aW9ucyB0aGF0IG1heSBoYXZlIGltcGFjdGVkIGl0IGV4Y2VwdGVkIHRoZSBmYWxsIGJvbnVzLCBidXQgd2UgYmVsaWV2ZSB0aGF0IGl0IGhhZCBsaXR0bGUgY29zdCwgbGl0dGxlIG9wcG9ydHVuaXR5IGNvc3QgYW5kIGhhZCBtb3N0bHkgYW4gaW1wYWN0IG9uICRyJC4gT24gdGhlIG9wcG9zaXRlLCB3ZSBkZWNpZGVkIHRvIGVzdGltYXRlICRtJCBhdCBhIGN1c3RvbWVyIGxldmVsIGJhc2VkIG9uIHBhc3QgcHVyY2hhc2luZyBiZWhhdmlvdXIuIEZvciB0aGUgcHVycG9zZSBvZiB0aGlzIGFzc2lnbm1lbnQgd2UgZGVjaWRlZCBub3QgdG8gZG8gdGhlIHNhbWUgdGVjaG5pcXVlIGZvciAkciQgc2luY2Ugd2UnbGwgZG8gaXQgaW4gYXNzaWdtZW50IElJSS4KCioqRGlzY291bnQgUmF0ZSoqCgpTaW5jZSB3ZSBhcmUgc3R1ZHlpbmcgYW4gaW5kdXN0cnkgd2hlcmUgY3VzdG9tZXJzIGhhdmUgcmVsYXRpdmVseSBzbWFsbCBsaWZlc3BhbiAoaW5mZXJpb3IgdG8gMyB5ZWFycyksIGNvc3Qgb2YgY2FwaXRhbCB3aWxsIGhhdmUgYSByZWxhdGl2ZWx5IHNtYWxsIGltcGFjdCBvbiBDTFYuIFdlIGRlY2lkZWQgdG8gdGFrZSAkZCQgPSAxMCUgd2hpY2ggc2VlbXMgdG8gYmUgYSByZWFzb25hYmxlIGFzc3VtcHRpb24gZm9yIHRoZSBzb2Z0d2FyZSBpbmR1c3RyeSBhY2NvcmRpbmcgdG8gYSBbTllVIHN0dWR5XShodHRwOi8vcGVvcGxlLnN0ZXJuLm55dS5lZHUvYWRhbW9kYXIvTmV3X0hvbWVfUGFnZS9kYXRhZmlsZS93YWNjLmh0bSkuCgpgYGB7cn0KQ0xWLmQgPC0gMC4xCmBgYAoKKipBY3F1aXNpdGlvbiBDb3N0KiogKHBlciBjdXN0b21lcikKCkZpcnN0LCBsZXQncyBlc3RpbWF0ZSB0aGUgYnVkZ2V0IGFsbG9jYXRlZCB0byBtYXJrZXRpbmcgZ2l2ZW4gdGhlIGFzc3VtcHRpb24gdGhhdCBpdCByZXByZXNlbnRzIDE1JSBvZiB0aGUgcmV2ZW51ZXM6CmBgYHtyfQojIFdlJ2xsIG5lZWQgdGhlIHBlcmlvZCBvZiB0aW1lIG9mIHRyYW5zYWN0aW9ucwpkYXlzX2luX3BlcmlvZCA8LSBhcy5udW1lcmljKGFsbC5lbmQgLSBhbGwuYmVnaW4pCgojIFRvdGFsIGRhaWx5IHJldmVudWVzCnRvdGFsX2RhaWx5X3JldmVudWVzIDwtIHN1bSh0eC5hbGwkVmFsdWUpIC8gZGF5c19pbl9wZXJpb2QKCiMgVG90YWwgZGFpbHkgYW1vdW50IHNwZW5kIGluIG1hcmtldGluZwp0b3RhbF9kYWlseV9tYXJrZXRpbmdfY29zdCA8LSAwLjE1ICogdG90YWxfZGFpbHlfcmV2ZW51ZXMKYGBgCgpOb3cgZ2l2ZW4gdGhpcyBkYWlseSBtYXJrZXRpbmcgc3BlbmRpbmcsIGxldCdzIGVzdGltYXRlIHRoZSBjb3N0IG9mIGFjcXVpc2l0aW9uIHBlciBjdXN0b21lcjoKYGBge3J9CiMgV2UnbGwgbmVlZCB0aGUgcGVyaW9kIG9mIHRpbWUgb2YgcmVnaXN0cmF0aW9uCmRheXNfaW5fcmVnaXN0cmF0aW9uX3BlcmlvZCA8LSBhcy5udW1lcmljKG1heChzZXNzaW9ucy5hbGwkRGF0ZSkgLSBtaW4oYXMuRGF0ZShjdXN0b21lciRSZWdpc3RyYXRpb25kYXRlKSkpCgojIE5vdyB3ZSB3YW50IHRvIGNhbGN1bGF0ZSB0aGUgY29zdCBwZXIgY3VzdG9tZXIKQ0xWLkFDIDwtIHRvdGFsX2RhaWx5X21hcmtldGluZ19jb3N0ICogZGF5c19pbl9yZWdpc3RyYXRpb25fcGVyaW9kIC8gbnJvdyhjdXN0b21lcikKCnNwcmludGYoIkFjcXVpc2l0aW9uIENvc3QgaXMgZXN0aW1hdGVkIHRvOiAkJS4yZiIsIENMVi5BQykKYGBgCgoqKlJldGVudGlvbiByYXRlKioKCkZpcnN0IHdlJ2xsIG5lZWQgdG8gZGVmaW5lIHdoZW4gd2UgY29uc2lkZXIgdGhhdCBhIGN1c3RvbWVyIGhhcyBjaHVybmVkLiBJbiB0aGlzIGFzc2lnbm1lbnQgd2UgZGVjaWRlZCB0byBkZWZpbmUgY2h1cm5pbmcgYmFzZWQgb24gYWN0aXZpdHkgKG51bWJlciBvZiBzZXNzaW9ucyBwbGF5ZWQpIGFuZCBub3Qgb24gZmluYW5jaWFsIHRyYW5zYWN0aW9ucy4gWW91IG1heSBjaGVjayBhc3NpZ21lbnQgMyBpZiB5b3UgYXJlIGludGVyZXN0ZWQgaW4gYSBkZWZpbml0aW9uIG9mIGNodXJuaW5nIGJhc2VkIG9uIHRyYW5zYWN0aW9ucy4KClRvIGRvIHRoYXQgd2UgbWlnaHQgd2FudCB0byBsb29rIGF0IGFuIGhpc3RvZ3JhbSBvZiB0aGUgYXZlcmFnZSB0aW1lIChpbiBkYXlzKSBiZXR3ZWVuIHR3byBzZXNzaW9ucy4gTGV0J3MgZG8gdGhhdDoKCmBgYHtyfQpjdXN0b21lci5zZXNzaW9ucyA8LSBzZXNzaW9ucy5hbGwgJT4lCiAgZ3JvdXBfYnkoQ3VzdG9tZXJJRCkgJT4lCiAgIyBhdmdfaW50ZXJ2YWwgaXMgdGhlIGF2ZXJhZ2UgaW50ZXJ2YWwgaW4gZGF5cyBiZXR3ZWVuIHRoZSBmaXJzdCBhbmQgdGhlIGxhc3Qgc2Vzc2lvbiBvZiBhIGN1c3RvbWVyCiAgc3VtbWFyaXNlKGZpcnN0ID0gbWluKERhdGUpLCBsYXN0ID0gbWF4KERhdGUpLCBjb3VudCA9IG4oKSwgYXZnX2ludGVydmFsID0gYXMubnVtZXJpYyhsYXN0IC0gZmlyc3QpL2NvdW50KSAlPiUKICAjIHdlIGNhbid0IGNhbGN1bGF0ZSBhbiBpbnRlcnZhbCB3aXRoIG9ubHkgb25lIHZhbHVlIHNvIGxldCdzIHJlbW92ZSB0aG9zZSBsaW5lcwogIGZpbHRlcihjb3VudCA+IDEpCgojIE5vdyBsZXQncyBwbG90IHRoYXQKZ2dwbG90KGN1c3RvbWVyLnNlc3Npb25zKSArIGdlb21faGlzdG9ncmFtKGJpbndpZHRoID0gMTApICsgYWVzKHggPSBhdmdfaW50ZXJ2YWwpCmBgYAoKV2Ugbm90aWNlIHRoYXQgbW9yZSB0aGFuIDk5JSBvZiBjdXN0b21lcnMgaGF2ZSBhbiBhdmVyYWdlIGRheSBpbnRlcnZhbCBiZXR3ZWVuIHNlc3Npb25zIGluZmVyaW9yIHRvIDYwIGRheXMuIFNvIGxldCdzIGRlZmluZSBhbiBhY3RpdmUgdXNlciBhcyBzb21lb25lIHdobyBwbGF5ZWQgYXQgbGVhc3Qgb25jZSBpbiB0aGUgbGFzdCA2MCBkYXlzLiBUaHVzIGEgdXNlciBoYXMgY2h1cm5lZCBpZiBoZSBoYXMgbm90IHBsYXllZCBzZXNzaW9ucyBpbiBtb3JlIHRoYW4gNjAgZGF5cy4KCk5vdyB0byBkZXRlcm1pbmUgcmV0ZW50aW9uLiBUbyBkbyB0aGlzOgoKMSkgV2UnbGwgdGFrZSBhIGNvaG9ydCBvZiAiYWN0aXZlIiBhcyBvZiBKdW5lIDMwdGggKGFsbCB0aGUgY3VzdG9tZXJzIHdobyBwbGF5ZWQgYXQgbGVhc3Qgb24gc2Vzc2lvbiBpbiBtYXkgb3IganVuZSkKMikgSW4gdGhpcyBjb2hvcnQgd2UnbGwgY2hlY2sgd2hpY2ggb25lIGFyZSBzdGlsbCAiYWN0aXZlIiBhcyBvZiBPY3RvYmVyIDMxc3QgKGFsbCB0aGUgY3VzdG9tZXJzIHdobyBwbGF5ZWQgYXQgbGVhc3Qgb25lIHNlc3Npb24gaW4gc2VwdGVtYmVyIG9yIG9jdG9iZXIpCjMpIFRoZSByYXRpbyBvZiAoMikgb3ZlciAoMSkgcmVwcmVzZW50cyB0aGUgNC1tb250aCByZXRlbnRpb24gcmF0ZQo0KSBXZSB3aWxsIG5lZWQgdG8gdHJhbnNmb3JtIGl0IHRvIHRoZSBhbm51YWwgcmV0ZW50aW9uIHJhdGUKCmBgYHtyfQojIDEpIENvaG9ydApjb2hvcnQgPC0gc2Vzc2lvbnMuYWxsICU+JQogIGZpbHRlcihEYXRlID49IGFzLkRhdGUoIjIwMTgtMDUtMDEiKSwgRGF0ZSA8IGFzLkRhdGUoIjIwMTgtMDctMDEiKSkgJT4lCiAgZ3JvdXBfYnkoQ3VzdG9tZXJJRCkgJT4lCiAgZGlzdGluY3QoQ3VzdG9tZXJJRCkgJT4lCiAgc2VsZWN0KEN1c3RvbWVySUQpCgojIDIpIEN1c3RvbWVyIGluIGNvaG9ydCBzdGlsbCBhY3RpdmUgYXMgb2YgT2N0b2JlciAzMXN0CmFjdGl2ZSA8LSBzZXNzaW9ucy5hbGwgJT4lCiAgZmlsdGVyKERhdGUgPj0gYXMuRGF0ZSgiMjAxOC0wOS0wMSIpLCBEYXRlIDwgYXMuRGF0ZSgiMjAxOC0xMS0wMSIpKSAlPiUKICBncm91cF9ieShDdXN0b21lcklEKSAlPiUKICBkaXN0aW5jdChDdXN0b21lcklEKSAlPiUKICBzZWxlY3QoQ3VzdG9tZXJJRCkKY29ob3J0LmFjdGl2ZSA8LSBjb2hvcnQgJT4lIGlubmVyX2pvaW4oYWN0aXZlLCBieSA9ICJDdXN0b21lcklEIikKCiMgMykgNC1tb250aCByZXRlbnRpb24gcmF0ZQpyLjRtIDwtIG5yb3coY29ob3J0LmFjdGl2ZSkgLyBucm93KGNvaG9ydCkKCiMgNCkgMS15ZWFyIHJldGVudGlvbiByYXRlCkNMVi5yIDwtIHIuNG1eKDEyLzQpCgpzcHJpbnRmKCJSZXRlbnRpb24gcmF0ZSBpcyBlc3RpbWF0ZWQgdG86ICUuMmYgcGVyY2VudCIsIENMVi5yKjEwMCkKYGBgCgoqKk51bWJlciBvZiB5ZWFycyAnb3V0JyoqCgpJbiBvcmRlciB0byB0YWtlIG5vIHJpc2sgd2Ugd2lsbCB0YWtlICRUJCBzbyB0aGF0IGFmdGVyICRUJCB5ZWFycyBhIGN1c3RvbWVyIGhhcyBhIHByb2JhYmlsaXR5IG9mIGhhdmluZyBjaHVybiBzdXBlcmlvciB0byA5MCUuIEluIG1hdGhlbWF0aWNhbCBsYW5ndWFnZSB0aGlzIGdpdmVzIHVzOiAkVCA9IGxuKDAuMSkgLyBsbihyKSQKCmBgYHtyfQpDTFYuVCA8LSBsb2coMC4xKSAvIGxvZyhDTFYucikKCnNwcmludGYoIk51bWJlciBvZiB5ZWFycyAnb3V0JyBpcyBlc3RpbWF0ZWQgdG86ICUuMmYgeWVhcnMiLCBDTFYuVCkKYGBgCgoqKkN1c3RvbWVyIHJlY3VycmluZyBjb250cmlidXRpb24gbWFyZ2luKioKCk5vdyB3ZSB3YW50IHRvIGVzdGltYXRlIHRoZSBjb250cmlidXRpb24gbWFyZ2luIGdlbmVyYXRlZCBieSBhIGN1c3RvbWVyLgoKRm9yIHRoZSBwdXJwb3NlIG9uIHRoaXMgYXNzaWdubWVudCB3ZSBkZWNpZGVkIHRvIGFzc3VtZSB0aGF0IHRoZSByZWN1cnJpbmcgY29zdCBmb3IgYWxsIGN1c3RvbWVycyByZXByZXNlbnRlZCAxMCUgb2YgdG90YWwgcmV2ZW51ZXMuIFNvIHdlIGFwcGxpZWQgY2FsY3VsYXRpb24gc2ltaWxhciB0byAkQUMkCgpgYGB7cn0KQ0xWLnJjIDwtIDAuMTAgKiB0b3RhbF9kYWlseV9yZXZlbnVlcyAqIDM2NSAvIG5yb3coY3VzdG9tZXIpCmBgYAoKTm93LCBsZXQncyBmb2N1cyBvbiByZWN1cnJpbmcgcmV2ZW51ZXMuIEZpcnN0LCB3ZSB0aG91Z2h0IGFib3V0IGVzdGltYXRpbmcgdGhlIHJlY3VycmluZyByZXZlbnVlcyBieSB0aGUgYXZlcmFnZSBwdXJjaGFzZSBieSBjdXN0b21lci4gQnV0IHdlIGZpZ3VyZWQgdGhhdCB0aGVyZSB3ZXJlIHNpZ25pZmljYW50IHZhcmF0aW9uIGJldHdlZW4gdGhlIGJhc2tldHMgb2YgZGlmZmVyZW50IGN1c3RvbWVycy4gU28gd2UgdHJpZWQgdG8gYXBwbHkgdGhlIHNhbWUgcmVhc29uaW5nIGF0IGEgY3VzdG9tZXIgbGV2ZWwgYnkgZXN0aW1hdGluZyBmdXR1cmUgcHVyY2hhc2VzIGJ5IHBhc3QgcHVyY2hhc2luZyBiZWhhdmlvdXIuIEJ1dCB0aGF0IGRvZXMgbm90IGFjY291bnQgZm9yIHRoZSBmYWN0IHRoYXQgdGhlIGF2ZXJhZ2UgYW1vdW50IGJvdWdodCBpbiBwcmV2aW91cyBwZXJpb2RzIGlzIGEgcG9vciBlc3RpbWF0b3IgZnV0dXJlIHB1cmNoYXNlcy4gSW5kZWVkLCB1c2luZyBzdWNoIG1vZGVsIGEgdXNlciB0aGF0IGhhcyBuZXZlciBib3VnaHQgYW55dGhpbmcgd2lsbCBuZXZlciBidXkgYW55dGhpbmcsIHNvIGhlIGhhcyBpbmV2aXRhbHkgYSBuZWdhdGl2ZSBDTFYgd2hpY2ggc2hvdWxkIG5vdCBhbHdheXMgYmUgdGhlIGNhc2UuCgpTbywgaW4gdGhlIGVuZCB3ZSBjaG9zZSB0byBidWlsZCBhIGxpbmVhciBtb2RlbCB0byBlc3RpbWF0ZSBob3cgbXVjaCBhIGN1c3RvbWVyIGlzIGxpa2VseSB0byBidXkgaW4gb2N0b2JlciBiYXNlZCBvbiBoaXMgcHVyY2hhc2luZyBiZWhhdmlvdXIgb2YgdGhlIHByZXZpb3VzIG1vbnRocy4KCkZpcnN0LCBsZXQncyBidWlsZCB0YWJsZXMgY29udGFpbmluZyBpbmZvcm1hdGlvbiBvZiBwYXN0IHB1cmNoYXNlcywgYnkgY3VzdG9tZXIgYW5kIGJ5IG1vbnRoOgoKYGBge3J9CmN1c3RvbWVySUQuYWxsIDwtIGRhdGFfZnJhbWUoQ3VzdG9tZXJJRD1jdXN0b21lciRDdXN0b21lcklEKQp0eC5hbGwkTW9udGggPSBmb3JtYXQodHguYWxsJERhdGUsICIlbSIpCmNvbHVtbnMgPC0gYygnMDUnLCAnMDYnLCAnMDcnLCAnMDgnLCAnMDknLCAnMTAnKQptb250aGx5LnR4LmFsbCA8LSBjdXN0b21lcklELmFsbCAlPiUKICBsZWZ0X2pvaW4odHguYWxsLCBieSA9ICJDdXN0b21lcklEIikgJT4lCiAgc3ByZWFkKE1vbnRoLCBWYWx1ZSkgJT4lCiAgc2VsZWN0KC1jKFg6UHJvZHVjdElEKSkgJT4lCiAgbXV0YXRlX2F0KC52YXJzID0gY29sdW1ucywgZnVucyhyZXBsYWNlX25hKC4sMCkpKSAlPiUKICBncm91cF9ieShDdXN0b21lcklEKSAlPiUKICBzdW1tYXJpc2VfYXQoLnZhcnMgPSBjb2x1bW5zLCBmdW5zKHN1bSkpCmhlYWQobW9udGhseS50eC5hbGwpCgptb250aGx5LnR4IDwtCiAgdHguYWxsICU+JQogIHNwcmVhZChNb250aCwgVmFsdWUpICU+JQogIHNlbGVjdCgtYyhYOkRhdGUsIFByb2R1Y3RJRCkpICU+JQogIG11dGF0ZV9hdCgudmFycyA9IGNvbHVtbnMsIGZ1bnMocmVwbGFjZV9uYSguLDApKSkgJT4lCiAgZ3JvdXBfYnkoQ3VzdG9tZXJJRCkgJT4lCiAgc3VtbWFyaXNlX2F0KC52YXJzID0gY29sdW1ucywgZnVucyhzdW0pKQpoZWFkKG1vbnRobHkudHgpCmBgYAoKV2UgY29tZXMgdGhlIGVzdGltYXRpb24gb2YgdGhlIHJlY3VycmluZyByZXZlbnVlcyBvZiBlYWNoIGN1c3RvbWVyOgoKYGBge3J9CnNldC5zZWVkKDExKQoKIyBzZWxlY3QgdGhlIGluZGV4ZXMgb2YgdGhlIHJvd3MgaW4gdGhlIHRyYWluaW5nIHNldAp0cmFpbi5pbmRleCA8LSBjcmVhdGVEYXRhUGFydGl0aW9uKAogIG1vbnRobHkudHguYWxsJGAxMGAsCiAgcCA9IC45LAogIGxpc3QgPSBGQUxTRSwKICB0aW1lcyA9IDEKICApCgojIHNwbGl0IHRoZSBkYXRhCnRyYWluICAgPC0gbW9udGhseS50eC5hbGxbIHRyYWluLmluZGV4LF0KdGVzdCAgICA8LSBtb250aGx5LnR4LmFsbFstdHJhaW4uaW5kZXgsXQp0cmFpbi55IDwtIHRyYWluJGAxMGAKdGVzdC55ICA8LSB0ZXN0JGAxMGAKCiMgYnVpbGQgdGhlIG1vZGVsCiMgYWZ0ZXIgdHJ5aW5nIGRpZmZlcmVudCBtb2RlbHMgd2Uga2VwdCB0aGUgbGluZWFyIG1vZGVsIGJlY2F1c2UgaXQgd2FzIG1vcmUgc2ltcGxlIHdpdGggdmVyeSBjb21wYXJhYmxlIHJlc3VsdHMKIyB3ZSBkZWNpZGVkIHRvIGFkZCBhbiBpbnRlcmNlcHQgdmFyaWFibGUgdG8gYWNjb3VudCBmb3IgdGhlIGZhY3QgdGhhdCBhIHVzZXIgd2hvIG5ldmVyIGJvdWdodCBhbnl0aGluZyBtaWdodCBzdGFydCBidXlpbmcKIyBUaGlzIGhhcyBhIEhVR0UgaW1wYWN0IG9uIHRoZSBmaW5hbCByZXN1bHQ6CiMgICAgIHdpdGggaW50ZXJjZXB0LCBhIGN1c3RvbWVyIHdobyBhcyBuZXZlciBib3VnaHQgYXMgYSBDTFYgb2YgMi41CiMgICAgIHdpdGhvdXQgaW50ZXJjZXB0LCBhIGN1c3RvbWVyIHdobyBhcyBuZXZlciBib3VnaHQgYXMgYSBDTFYgb2YgLTUuNQojIFRoZSBhbnN3ZXIKbW9kZWwucmV2ZW51ZSA8LSBsbShgMTBgfi4gLSBDdXN0b21lcklELCBkYXRhPXRyYWluKQoKIyBjaGVjayB0aGUgbW9kZWwKc3VtbWFyeShtb2RlbC5yZXZlbnVlKQoKIyBjaGVjayB0aGUgcGVyZm9ybWFuY2Ugb2YgdGhlIG1vZGVsCnRyYWluLnByZWQgPC0gcHJlZGljdChtb2RlbC5yZXZlbnVlLCB0cmFpbikKdGVzdC5wcmVkICA8LSBwcmVkaWN0KG1vZGVsLnJldmVudWUsIHRlc3QpCnNwcmludGYoIkF2ZXJhZ2UgYWJzb2x1dGUgZXJyb3IgYnkgY3VzdG9tZXIgKG9uIHRyYWluaW5nIHNldCk6ICQlLjJmIiwgbWVhbihhYnModHJhaW4ueS10cmFpbi5wcmVkKSkpCnNwcmludGYoIkF2ZXJhZ2UgYWJzb2x1dGUgZXJyb3IgYnkgY3VzdG9tZXIgKG9uIHRlc3Rpbmcgc2V0KTogJCUuMmYiLCBtZWFuKGFicyh0ZXN0LnktdGVzdC5wcmVkKSkpCmBgYAoKTm90IHN1cnByaXNpbmdseSwgdGhlIHJlc3VsdHMgYXJlbid0IGluY3JlZGlibGUsIGJ1dCB3ZSB3b3VsZG4ndCBzdHVkeSBDdXN0b21lciBBbmFseXRjaXMgaWYgaXQgd2VyZSBwb3NzaWJsZSB0byBwZXJmZWN0bHkgcHJlZGljdCB3aGF0IGEgY3VzdG9tZXIgd2lsbCBidXkgaW4gdGhlIGZ1dHVyZS4KClN0aWxsLCBpdCBpcyBhIGJldHRlciBlc3RpbWF0b3Igb2Ygd2hhdCdzIGhlIGlzIGdvaW5nIHRvIGJ1eSB0aGFuIHRoZSBhdmVyYWdlIG9mIHdoYXQgaGUgYm91Z2h0IHRoZSBwYXN0IG1vbnRocyAoc2VlIHJlc3VsdHMgYmVsb3cpLiBBbmQgb3VyIG1vZGVsIGlzIHN1cmVseSBtb3JlIHBlcmZvcm1hbnQgdG8gZXN0aW1hdGUgd2hhdCBvdXIgY3VzdG9tZXIgd2lsbCBrZWVwIGJ1eWluZyBpbiB0aGUgbW9udGhzIGFmdGVyIE9jdG9iZXIuCgpgYGB7cn0KcHJpbnQobWVhbihhYnModGVzdC55LXJvd01lYW5zKHRlc3RbLC1jKDEsNyldKSkpKQpgYGAKCioqQ2FsY3VsYXRpb24gb2YgQ0xWKioKCk5vdyB0aGF0IHdlIGhhdmUgZXN0aW1hdGVkIGFsbCBwYXJhbWV0ZXJzOgoKYGBge3J9CkNMVi5jb25zdCA9IGRhdGFfZnJhbWUoQUM9Q0xWLkFDLCByYz1DTFYucmMsIHI9Q0xWLnIsIFQ9Q0xWLlQsIGQ9Q0xWLmQpCkNMVi5jb25zdApgYGAKCldlIGNhbiBjcmVhdGUgdGhlIENMViBmdW5jdGlvbjoKCmBgYHtyfQpDTFYgPC0gZnVuY3Rpb24gKENMVi5jb25zdCwgbW9kZWwsIGlkKSB7CiAgZGZfaWQgPC0gZGF0YV9mcmFtZShDdXN0b21lcklEPWlkKQogIG1vZGVsLmlucHV0IDwtIGRmX2lkICU+JSBsZWZ0X2pvaW4obW9udGhseS50eC5hbGwsIGJ5ID0gIkN1c3RvbWVySUQiKQogICMgUGVyaW9kIG9mIHRpbWUgdG8gY29udmVydCByZXZlbnVlIHRvIChhbm51YWwpIHJlY3VycmluZyByZXZlbnVlCiAgcnIgPC0gMTIgKiBwcmVkaWN0KG1vZGVsLCBtb2RlbC5pbnB1dCkKCiAgIyBDdXN0b21lciB2YWx1ZQogIEFDIDwtIENMVi5jb25zdCRBQyAgICAgICAjIEN1c3RvbWVyIGFjcXVpc2l0aW9uIGNvc3RzCiAgcmMgPC0gQ0xWLmNvbnN0JHJjICAgICAgICMgUmVjdXJyaW5nIGNvc3QKICBtICA8LSByciAtIENMVi5jb25zdCRyYyAgIyBDdXN0b21lciByZWN1cnJpbmcgY29udHJpYnV0aW9uIG1hcmdpbgogIHIgIDwtIENMVi5jb25zdCRyICAgICAgICAjIFJldGVudGlvbiBwcm9iYWJpbGl0eSBmb3IgdGhlIGN1c3RvbWVyCiAgdCAgPC0gQ0xWLmNvbnN0JFQgICAgICAgICMgTnVtYmVyIG9mIHllYXJzICdvdXQnIHRvIGVzdGltYXRlCiAgZCAgPC0gQ0xWLmNvbnN0JGQgICAgICAgICMgRGlzY291bnQgcmF0ZSAoQ29zdCBvZiBDYXBpdGFsKQoKICAjIHByaW50KGNiaW5kKEFDLCByYywgbSwgciwgdCwgZCkpCgogIGNsdiA8LSAtQUMKICBmb3IoaSBpbiAwOnQpIHsKICAgIGNsdiA8LSBjbHYrKChyXmkpKm0vKDErZCleaSkKICB9CiAgcmV0dXJuKGNsdikKfQpgYGAKCkFuZCBjYWxjdWxhdGUgbGUgY2x2IGZvciBldmVyeSBjdXN0b21lcjoKCmBgYHtyfQpjdXN0b21lci5hY3RpdmUgPC0gY3VzdG9tZXIuYWN0aXZlICU+JSBtdXRhdGUoQ0xWID0gQ0xWKENMVi5jb25zdCwgbW9kZWwucmV2ZW51ZSwgQ3VzdG9tZXJJRCkpCnN1bW1hcnkoY3VzdG9tZXIuYWN0aXZlKQpgYGAKCiMjIyBEZW1vZ3JhcGhpYyBBbmFseXNpcyAmIFByb2ZpbGluZwoKV2Ugd2lsbCBza2V0Y2ggZ2VuZXJhbCBwcm9maWxlcyBvZiB0aGUgYWN0aXZlIGN1c3RvbWVycy4KCkZpcnN0LCBsZXQncyBoYXZlIGEgbG9vayBhdCBob3cgZ2VuZGVyIG9mIHRoZSBwbGF5ZXJzIGFyZSBkaXNwYXRjaGVkIGFtb25nIHRoZSBwbGF5c2VycyA6CgpgYGB7cn0KZ2dwbG90KGN1c3RvbWVyLmFjdGl2ZSkrYWVzKHg9U2V4KStnZW9tX2JhcigpCgpgYGAKCldlIGNhbiBzZWUgdGhhdCB0aGVyZSBhcmUgbW9yZSBtYWxlIHBsYXllcnMgb3ZlcmFsbC4KCk5vdywgd2Ugd2lsbCBjb25zaWRlciB0aGF0IHRoZSBnZW5lcmFsIHByb2ZpbGUgb2YgYSBwbGF5ZXIgaXMgYSBtYWxlIGFuZCB3ZSdsbCBub3cgaGF2ZSBhIGxvb2sgYXQgaG93IHRoZXkgYXJlIGRpc3BhdGNoZWQgdGhyb3VnaCBhZ2UgY2F0ZWdvcmllcy4KCmBgYHtyfQpnZ3Bsb3QoY3VzdG9tZXIuYWN0aXZlICU+JSBmaWx0ZXIoU2V4PT0wKSkrYWVzKHg9QWdlX2NhdGVnb3J5KStnZW9tX2JhcigpCmBgYAoKV2UgY2FuIHNlZSB0aGF0IHRoZXJlIGFyZSBtdWNoIG1vcmUgcGxheWVycyBiZXR3ZWVuIDI0LTM1IG92ZXJhbGwuIFRodXMsIG1vc3Qgb2YgdGhlIHBsYXllcnMgYXJlIG1hbGUgYmV0d2VlbiAyNC0zNS4KCk5vdywgd2UnbGwgY29tYXByZSB0aGUgaW5jb21lIGxldmVsIG9mIG1hbGUgcGxheWVycyBiZXR3ZWVuIDI0LTM1IDoKCmBgYHtyfQpnZ3Bsb3QoY3VzdG9tZXIuYWN0aXZlICU+JSBmaWx0ZXIoQWdlX2NhdGVnb3J5ID09ICIyNC0zNSIsIFNleCA9PSAwKSkgKyBhZXMoeD1JbmNvbWUpICsgZ2VvbV9iYXIoKQpgYGAKClRodXMsIHdlIGNhbiBzZWUgdGhhdCB0aGUgbnVtYmVyIG9mIHBsYXllcnMgaXMgcXVpdGUgdGhlIHNhbWUgcGVyIGluY29tZSBsZXZlbC4gVGhlcmUgaXMgbm8gc2lnbmlmaWNhdGl2ZSBkaWZmZXJlbmNlLiBXZSBjYW4gZGVkdWNlIHRoYXQgYSBnZW5lcmFsIHBsYXllciBjYW4gaGF2ZSBhbnkgbGV2ZWwgb2YgaW5jb21lLgoKVGh1cywgaWYgd2UgdGFrZSBpbnRvIGFjY291bnQgdGhlIHRvdGFsIG51bWJlciBvZiBwbGF5ZXJzIHBlciBkZW1vZ3JhcGhpYyBtZXRyaWNzLCB0aGUgcHJvZmlsZSBvZiBhIGdlbmVyYWwgcGxheWVyIHdvdWxkIGJlIGEgbWFsZSBiZXR3ZWVuIDI0LTM1IGFuZCB3aXRoIGFueSBpbmNvbWUgbGV2ZWwuCgpOb3csIGxldCdzIGFkZCBpbiBvdXIgcmVhc29ubmluZyB0aGUgdHlwZSBvZiBwbGF5ZXIgd2l0aCB0aGUgZ2VuZXJhbCBkZW1vZ3JhcGhpYyBwcm9maWxlIHdlIGZvdW5kLgoKYGBge3J9CmdncGxvdChjdXN0b21lci5hY3RpdmUgJT4lIGZpbHRlcihBZ2VfY2F0ZWdvcnkgPT0gIjI0LTM1IiwgU2V4ID09IDApKSArYWVzKHg9QWdlX2NhdGVnb3J5LGZpbGw9YXMuZmFjdG9yKEN1c3RvbWVyVHlwZSkpK2dlb21fYmFyKCkKCmBgYAoKT25jZSBhZ2Fpbiwgd2UgY2FuIHNlZSBubyBzaWduaWZpY2F0aXZlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUgY3VzdG9tZXIgdHlwZSwgZXZlbiBpZiB0aGUgIkNhdGNoZXJzIiBhcmUgdGhlIG1vc3QgbnVtZXJvdXMuIFRodXMsIHdlIHdpbGwgY29uc2lkZXIgdGhhdCB0aGVzZSBwbGF5ZXJzIGNhbiBiZSBvZiBhbnkgdHlwZS4KCk5vdywgbGV0J3MgYWRkIGluIG91ciByZWFzb25uaW5nIHRoZSBmaW5hbmNpYWwgdmFsdWUgdXNpbmcgTW9uZXRhcnkgYW5kIEZyZXF1ZW5jeSBmb3IgdGhlIGRlbW9ncmFwaGljIHByb2ZpbGUgd2UgY2hvc2UuCgoKYGBge3J9CmN1c3RvbWVyLmFjdGl2ZSAlPiUgZmlsdGVyKEFnZV9jYXRlZ29yeSA9PSAiMjQtMzUiLCBTZXggPT0gMCkgJT4lIHN1bW1hcmlzZShtZWFuKE1vbmV0YXJ5KSxtZWFuKEZyZXF1ZW5jeSksbWVhbihDTFYpKQpgYGAKClRodXMsIHdlIGNhbiBjb21wbGV0ZSB0aGUgZ2VuZXJhbCBwcm9maWxlIGJ5IHNheWluZyB0aGF0IGNhbiB0aGUgZ2VuZXJhbCBwcm9maWxlIGlzIGEgcGxheWVyIDoKLSBtYWxlIGJldHdlZW4gMjQtMzUKLSBzcGVuZGluZyBvbiBhdmVyYWdlIDYuMTMgd2l0aCBhIGZyZXF1ZW5jeSBvZiAwLjYxIG9uIHRoZSBwZXJpb2QuIAoKCiMgQXNzaWdubWVudCBJSSwgTGlmZWN5Y2xlIGdyaWRzOgoKSW4gbGlmZSBjeWNsZSBncmlkcywgd2UgYXJlIGZvY3VzaW5nIG9uIHRoZSBSICYgRiBvZiBSRk0uIEluIG90aGVyIHdvcmRzLCBpbiBmcmVxdWVudCBhbmQgcmVjZW50IHB1cmNoYXNlcyBiZWNhdXNlIGZyZXF1ZW5jeSBhZmZlY3RzIGNsaWVudCdzIGxpZmV0aW1lIHZhbHVlIGFuZCByZWNlbmN5IGFmZmVjdHMgcmV0ZW50aW9uLgpUaGUgcHVycG9zZSB0aGVyZWZvcmUgaXMgdG8gcHJvdmlkZSBhIHRhcmdldCBvZmZlciB0byBzcGVjaWZpYyBzZWdtZW50cyBvciBjdXN0b21lcnMuCgojIyMgQSBzbWFsbCBsb29rIGF0IFIgJiBGIGRpc3RyaWJ1dGlvbnMKCipOb3RlOiB0aGUgbWF4aW11bSBvZiBjdXN0b21lciByZWdpc3RyYXRpb24gZGF0ZSBpcyAzMC0wNC0yMDI4IHNvIHdlIGFyZSBzdXJlIHRoYXQgY3VzdG9tZXIuYWN0aXZlIGRhdGEgZG9lc24ndCBjb250YWluIGN1c3RvbWVycyB0aGF0IGNvdWxkIGhhdmUgcmVnaXN0ZXJlZCBpbiB0aGUgZmFsbCBwZXJpb2QuLi4qCgpgYGB7cn0KI0luaXRpYWxpc2F0aW9uOiBjb21iaW5pbmcgb3ZlcmFsbCB0cmFuc2FjdGlvbnMgd2l0aCBjdXN0b21lciBpbmZvCmN1c3RvbWVyLkxDRyA8LSB0eC5hbGwgJT4lIHNlbGVjdCgtWCkgJT4lIGlubmVyX2pvaW4oY3VzdG9tZXIuYWN0aXZlKQpzdW1tYXJ5KGN1c3RvbWVyLkxDRykKYGBgCgpgYGB7cn0KIyBGcmVxdWVuY3kgZGlzdHJpYnV0aW9uCmdncGxvdChjdXN0b21lci5MQ0cpK2Flcyh4PUZyZXF1ZW5jeSkrZ2VvbV9iYXIoKQpgYGAKCmBgYHtyfQojUmVjZW5jeSBEaXN0cmlidXRpb24gKGJ5IGRheXMpCmdncGxvdChjdXN0b21lci5MQ0cpK2Flcyh4PVJlY2VuY3kpK2dlb21fYmFyKCkKYGBgCgojIyMgTGlmZSBDeWNsZSBncmlkcwoKIyMjIyBJbnRyb2R1Y3Rpb24KCkxldCdzIGRvIG5vdyBsaWZlIGN5Y2xlIGdyaWRzLiBJbiB0aGlzIHBhcnQsIHdlIGRlY2lkZWQgdG8gY29uc2lkZXIgZnJlcXVlbmN5IG9uZSBieSBvbmUgdW50aWwgY3VzdG9tZXJzIGJ1eSBtb3JlIHRoYXQgNSBwcm9kdWN0cyAoYmVjYXVzZSB0aGUgZ2FwIGJldHdlZW4gMSBhbmQgMiBwcm9kdWN0cyBjYW5ub3QgYmUgZXF1YWxseSBjb25zaWRlcmVkIHRvIHRoZSBvbmUgYmV0d2VlbiA1IGFuZCA2IHByb2R1Y3RzIGJvdWdodCkuIAoKV2UgdXNlIHRoZSAnc2FtZScgcHJpbmNpcGxlIHRvIHNwbGl0IHRoZSByZWNlbmN5LiBNb3JlIHNwZWNpZmljYWxseSwgd2UgZGVjaWRlZCBzZWdtZW50IHRoZW0gLSByZWdhcmRpbmcgTmlhbnRpYyBwdXJwb3NlcyAtIHVzaW5nIHJlbGV2YW50IHRpbWUgcGVyaW9kczogCgotIDAtNiBkYXlzICYgNy0xMzogY3VzdG9tZXJzIHRoYXQgY2FuIGJlIGNvbnNpZGVyZWQgYXMgdmVyeSBmcmVxdWVudCBidXllcnMKLSAxNC0zMCA6IGN1c3RvbWVycyB0aGF0IGJvdWdodCByZWNlbnRseSAoZHVyaW5nIGZhbGwgcGVyaW9kIGJ1dCBzZWVtcyB0byBoYXZlIHNsb3dlZCBkb3duIHRoZWlyIHVzZSBvZiB0aGVpciB1c2Ugb2YgcGFja2FnZSB0byBwbGF5KQotIDMxLTUwOiBjdXN0b21lcnMgdGhhdCBoYXZlbid0IGJvdWdodCBmb3IgYSBxdWl0ZSBsb25nIHBlcmlvZCBhbmQgdGhhdCBjb3VsZCB3ZSBzaG91bGQgZm9jdXMgb24gdG8gcmVlbmdhZ2UgCi0gNTEtODU6IGN1c3RvbWVycyB0aGF0IHN0b3BwZWQgdG8gYnV5IGFmdGVyIHRoZSBzdW1tZXIgcGVyaW9kIC0gd2Ugc2hvdWxkIGVzcGVjaWFsbHkgbG9vayBhdCB0aG9zZSBvbmVzIHRvIGltcHJvdmUgdGhlIG1hcmtldGluZyBzdHJhdGVneSBwdXJwb3NlIGJldHdlZW4gc3VtbWVyIGFuZCBmYWxsIHBlcmlvZHMKLSA+IDg1OiBGaW5hbGx5LCBjdXN0b21lcnMgdGhhdCBjYW4gYmUgY29uc2lkZXJzIGFzIGxvbmctdGltZSBidXllcnMgb3IgdGhvc2Ugd2hvIGZvbGxvdyB0aGUgUG9rZW1vbiBHbyB0cmVuZCBvZiB0aGUgc3VtbWVyIGJ1dCB3aG8gd2VyZSBub3QgcmVhbGx5IGludGVyZXN0ZWQgdG8gZXZvbHZlIHJhcGlkbHkgd2l0aCBQb2tlbW9uJ3MgcGFja2FnZXMKCmBgYHtyfQojQ3JlYXRpb24gb2YgR3JpZHMKY3VzdG9tZXIuTENHIDwtIGN1c3RvbWVyLkxDRyAlPiUKICBtdXRhdGUoc2VnbS5mcmVxPWlmZWxzZShGcmVxdWVuY3kgPT0gMSwgJzEnLAogICAgICAgICAgICAgICAgICAgICAgICAgIGlmZWxzZShGcmVxdWVuY3kgPT0gMiwgJzInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoRnJlcXVlbmN5ID09IDMsICczJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoRnJlcXVlbmN5ID09IDQsICc0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKEZyZXF1ZW5jeSA9PSA1LCc1JywnPjUnKSkpKSkpICU+JQogIG11dGF0ZShzZWdtLnJlYz1pZmVsc2UoYmV0d2VlbihSZWNlbmN5LDAsNiksICcwLTYgZGF5cycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKGJldHdlZW4oUmVjZW5jeSw3LDEzKSwgJzctMTMgZGF5cycsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKGJldHdlZW4oUmVjZW5jeSwgMTQsMzApLCAnMTQtMzAgZGF5cycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWZlbHNlKGJldHdlZW4oUmVjZW5jeSwzMSw1MCksICczMS01MCBkYXlzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoYmV0d2VlbihSZWNlbmN5LDUxLDg1KSwgJzUxLTg1IGRheXMnLCAnPjg1IGRheXMnKSkpKSkpCgojIHNwbGl0aW5nIGludG8gZGlzY3JldGUgZ3JvdXBzIHdpdGggbGV2ZWxzIHRvIG1ha2UgJiBpZGVudGlmeSBncmlkcyBsYXRlciBvbgpjdXN0b21lci5MQ0ckc2VnbS5mcmVxIDwtIGZhY3RvcihjdXN0b21lci5MQ0ckc2VnbS5mcmVxLCBsZXZlbHM9YygnPjUnLCc1JywnNCcsJzMnLCcyJywnMScpKQpjdXN0b21lci5MQ0ckc2VnbS5yZWMgPC0gZmFjdG9yKGN1c3RvbWVyLkxDRyRzZWdtLnJlYywgbGV2ZWxzPWMoJz44NSBkYXlzJywnNTEtODUgZGF5cycsJzMxLTUwIGRheXMnLCcxNC0zMCBkYXlzJywnNy0xMyBkYXlzJywnMC02IGRheXMnKSkKCnN1bW1hcnkoY3VzdG9tZXIuTENHKQpgYGAKCldlIHdpbGwgZmlyc3QgaGF2ZSBhIGxvb2sgYXQgdGhlIHZvbHVtZSBvZiB0cmFuc2FjdGlvbnMgcmVnYXJkaW5nIHRoZSBwZXJpb2QgKHJlY2VuY3kpIGFuZCB0aGUgZnJlcXVlbmN5LgoKIyMjIyBBcHByb2FjaCBpbiBWb2x1bWUgb2YgdHJhbnNhY3Rpb25zCgpgYGB7cn0KIyBHZW5lcmFsIE92ZXJ2aWV3CmxjZy5nZW4gPC0gY3VzdG9tZXIuTENHICU+JQogIGdyb3VwX2J5KHNlZ20ucmVjLCBzZWdtLmZyZXEpICU+JQogIHN1bW1hcmlzZShxdWFudGl0eT1uKCkpICU+JQogIG11dGF0ZShjbGllbnQ9J2NsaWVudCcpICU+JQogIHVuZ3JvdXAoKQoKI2xldCdzIGFkZCBzdWItY2F0ZWdvcmllcyB0byBiZXR0ZXIgZGlzdGluZ3Vpc2ggY3VzdG9tZXIgcHJvZmlsZXMgaW4gb3VyIGdyaWRzCmxjZy5nZW4gPC0gbGNnLmdlbiAlPiUgbXV0YXRlKHJlYy50eXBlID0gaWZlbHNlKHNlZ20ucmVjICVpbiUgYygnPjg1IGRheXMnLCAnNTEtODUgZGF5cycsICczMS01MCBkYXlzJyksICdub3QgcmVjZW50JywgJ3JlY2VudCcpLAogZnJlcS50eXBlID0gaWZlbHNlKHNlZ20uZnJlcSAlaW4lIGMoJz41JywgJzUnLCAnNCcpLCAnZnJlcXVlbnQnLCAnaW5mcmVxdWVudCcpLAogY3VzdG9tZXIuYmggPSBpbnRlcmFjdGlvbihyZWMudHlwZSwgZnJlcS50eXBlKSkKCgpnZ3Bsb3QobGNnLmdlbiwgYWVzKHg9Y2xpZW50LCB5PXF1YW50aXR5LCBmaWxsPWN1c3RvbWVyLmJoKSkrCiAgdGhlbWVfYncoKSArCiAgdGhlbWUocGFuZWwuZ3JpZCA9IGVsZW1lbnRfYmxhbmsoKSkrCiAgZ2VvbV9iYXIoc3RhdD0naWRlbnRpdHknLCBhbHBoYT0wLjcpICsKICBnZW9tX3JlY3QoYWVzKGZpbGwgPSBjdXN0b21lci5iaCksIHhtaW4gPSAtSW5mLCB4bWF4ID0gSW5mLCB5bWluID0gLUluZiwgeW1heCA9IEluZiwgYWxwaGEgPSAwLjEpICsKICBnZW9tX3RleHQoYWVzKHk9bWF4KHF1YW50aXR5KS8yLCBsYWJlbD1xdWFudGl0eSksIHNpemU9NCkgKwogIGZhY2V0X2dyaWQoc2VnbS5mcmVxIH4gc2VnbS5yZWMpKwogIGdndGl0bGUoIkxpZmVDeWNsZSBHcmlkczogTnVtYmVyIG9mIHRyYW5zYWN0aW9ucyBhbmQgdW5kZXJseWluZyBjYXRlZ29yaXNhdGlvbiIpCmBgYAoKYGBge3J9CmxjZy5ib251c190eXBlIDwtIGN1c3RvbWVyLkxDRyAlPiUKICBncm91cF9ieShzZWdtLnJlYywgc2VnbS5mcmVxLEN1c3RvbWVyVHlwZSxmYWxsYm9udXMpICU+JQogIHN1bW1hcmlzZShxdWFudGl0eT1uKCkpICU+JQogIHVuZ3JvdXAoKQoKZ2dwbG90KGxjZy5ib251c190eXBlLCBhZXMoeD1DdXN0b21lclR5cGUsIHk9cXVhbnRpdHksIGZpbGw9ZmFsbGJvbnVzKSkrCiAgdGhlbWVfYncoKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZSA9ICdTZXQxJykrCiAgdGhlbWUocGFuZWwuZ3JpZCA9IGVsZW1lbnRfYmxhbmsoKSkrCiAgZ2VvbV9iYXIoc3RhdD0naWRlbnRpdHknLCBhbHBoYT0wLjYpICsKICBmYWNldF9ncmlkKHNlZ20uZnJlcSB+IHNlZ20ucmVjKSsKICBnZ3RpdGxlKCJMaWZlQ3ljbGUgR3JpZHM6IE51bWJlciBvZiB0cmFuc2FjdGlvbnMgYnkgQ3VzdG9tZXJUeXBlIGFuZCBmYWxsYm9udXMiKQpgYGAKCgojIyMjIEFwcHJvYWNoIGluIE1vbmV0YXJ5IFZhbHVlIGZvciB0cmFuc2FjdGlvbnMKClRoZSBtb25ldGFyeSB2YWx1ZSBpcyB2ZXJ5IGludGVyZXN0aW5nIHRvIGltcHJvdmUgdGhlIG1hcmtldGluZyBzdHJhdGVneS4gCgpGb3IgYSB0aGlzIGFwcHJvYWNoIHdlIHdpbGwgaGF2ZSB0byBjb25zaWRlciBDQUMgYW5kIENMViB3ZSBwcmV2aXNvdWx5IGNhbGN1bGF0ZWQgb24gQXNzaWdubWVudCAxIGZvciBlYWNoIGN1c3RvbWVyIChub3RlIHRoYXQgd2UgYWxyZWFkeSBoYXZlIGl0IGluIHRoZSBjdXN0b21lci5hY3RpdmUgZGF0YXNldCB0aGF0IHdlIHRoZW4gbWVyZ2VkIHdpdGggdHguYWxsIHRvIGdldCBjdXN0b21lci5MQ0cpIApOb3RlIHRoYXQgdGhlIENBQyBpcyBhbHdheXMgdGhlIHNhbWUgKHRoaXMgaXMgdGhlIGFzc3VtcHRpb24gd2UgbWFkZSBpbiB0aGUgZmlyc3QgYXNzaWdubWVudCBiZWNhdXNlIHdlIGRvbid0IGhhdmUgZW5vdWdoIG1hcmtldGluZyBmaW5hbmNpYWxzIGluZm9ybWF0aW9uKS4gCgpgYGB7cn0KbGNnLmNsdiA8LSBjdXN0b21lci5MQ0cgJT4lCiAgbXV0YXRlKGNhYz1DTFYuY29uc3QkQUMpICU+JSAKICBncm91cF9ieShzZWdtLnJlYywgc2VnbS5mcmVxKSAlPiUKICBzdW1tYXJpc2UocXVhbnRpdHk9bigpLGNsdl90b3Q9cm91bmQoc3VtKENMVikpLGNsdl9hdmc9cm91bmQobWVhbihDTFYpKSxjYWNfdG90PXJvdW5kKHN1bShjYWMpKSxjYWNfYXZnPXJvdW5kKG1lYW4oY2FjKSkpICU+JQogIHVuZ3JvdXAoKQoKbGNnLmNsdiA8LSBtZWx0KGxjZy5jbHYsIGlkLnZhcnM9Yygnc2VnbS5yZWMnLCAnc2VnbS5mcmVxJywgJ3F1YW50aXR5JykpCgpnZ3Bsb3QobGNnLmNsdltsY2cuY2x2JHZhcmlhYmxlICVpbiUgYygnY2x2X3RvdCcsICdjYWNfdG90JyksIF0sIGFlcyh4PXZhcmlhYmxlLCB5PXZhbHVlLCBmaWxsPXZhcmlhYmxlKSkgKwogIHRoZW1lX2J3KCkgKwogIHRoZW1lKHBhbmVsLmdyaWQgPSBlbGVtZW50X2JsYW5rKCkpKwogIGdlb21fYmFyKHN0YXQ9J2lkZW50aXR5JywgYWxwaGE9MC42LCBhZXMod2lkdGg9cXVhbnRpdHkvbWF4KHF1YW50aXR5KSkpICsKICBnZW9tX3RleHQoYWVzKHk9dmFsdWUsIGxhYmVsPXZhbHVlKSwgc2l6ZT0zKSArCiAgZmFjZXRfZ3JpZChzZWdtLmZyZXEgfiBzZWdtLnJlYykgKwogIGdndGl0bGUoIkxpZmVDeWNsZSBHcmlkcyAtIENBQyB2cyBDTFYgVG90YWwiKQoKZ2dwbG90KGxjZy5jbHZbbGNnLmNsdiR2YXJpYWJsZSAlaW4lIGMoJ2Nsdl9hdmcnLCAnY2FjX2F2ZycpLCBdLCBhZXMoeD12YXJpYWJsZSwgeT12YWx1ZSwgZmlsbD12YXJpYWJsZSkpICsKICB0aGVtZV9idygpICsKICB0aGVtZShwYW5lbC5ncmlkID0gZWxlbWVudF9ibGFuaygpKSsKICBnZW9tX2JhcihzdGF0PSdpZGVudGl0eScsIGFscGhhPTAuNiwgYWVzKHdpZHRoPXF1YW50aXR5L21heChxdWFudGl0eSkpKSArCiAgZ2VvbV90ZXh0KGFlcyh5PXZhbHVlLCBsYWJlbD12YWx1ZSksIHNpemU9MykgKwogIGZhY2V0X2dyaWQoc2VnbS5mcmVxIH4gc2VnbS5yZWMpICsKICBnZ3RpdGxlKCJMaWZlQ3ljbGUgR3JpZHMgLSBDQUMgdnMgQ0xWIEF2ZXJhZ2UiKQpgYGAKCk5vdGUgdGhhdCB0aGUgd2lkdGggb2YgYmFycyBkZXBlbmRzIG9uIHRoZSBxdWFudGl0eSAoaS5lOiB0aGUgbnVtYmVyIG9mIGN1c3RvbWVycyBpbiB0aGlzIHN1Yi1jYXRlZ29yeSkKCiMgQXNzaWdtZW50IElJSSwgQ2h1cm4gYW5hbHlzaXMKCkluIHRoaXMgYXNzaWduZW50IHdlIHdhbnQgdG8gdW5kZXJzdGFuZCBtb3JlIHdoYXQgYXJlIHRoZSB2YXJpYWJsZXMgdGhhdCBoYXZlIGFuIGltcGFjdCBvbiBjaHVybiB0byBiZSBhYmxlIHRvIHByZWRpY3QgY2h1cm4gYmV0dGVyLgoKRmlyc3Qgd2UgbmVlZCB0byBiZSBjbGVhciBhYm91dCBjaHVybiBkZWZpbml0aW9uLiBUaGUgZGVmaW5pdGlvbiBwcm92aWRlZCBpbiB0aGUgYXNzaWdubWVudCBmb3IgY2h1cm4gaXMgYSBjdXN0b21lciB3aG8gZGlkIG5vdCBwZXJmb3JtIGFueSB0cmFuc2FjdGlvbiBpbiBmYWxsIDIwMTguCgo+IFJlbWlkZXI6IHdlIHdvcmtpbmcgb24gdGhlICJhY3RpdmUiIGJhc2V0YWJsZSBjb21wb3NlciBvZiBhbGwgY3VzdG9tZXIgdGhhdCBwbGF5ZWQgYXQgbGVhc3Qgb25jZSBkdXJpbmcgdGhlIHN1bW1lciwgcmVnYXJkbGVzcyB3ZXRoZXIgdGhleSBtYWRlIHRyYW5zYWN0aW9ucyBpbiBzdW1tZXIgb3Igbm90CgpgYGB7cn0KY3VzdG9tZXJJRC5hY3RpdmUuZmFsbCA8LSBzZXNzaW9ucy5mYWxsICU+JQogIGdyb3VwX2J5KEN1c3RvbWVySUQpICU+JQogIGRpc3RpbmN0KEN1c3RvbWVySUQpICU+JQogIHNlbGVjdChDdXN0b21lcklEKQoKY3VzdG9tZXIuYWN0aXZlIDwtIGN1c3RvbWVyLmFjdGl2ZSAlPiUKICBtdXRhdGUoQ2h1cm5lZCA9ICEgQ3VzdG9tZXJJRCAlaW4lIGN1c3RvbWVySUQuYWN0aXZlLmZhbGwkQ3VzdG9tZXJJRCkKYGBgCgpOb3cgbGV0J3MgYnVpbGQgZGlmZmVyZW50IG1vZGVscyBhbmQgY29tcGFyZSB0aGVtIHRvIGZpbmQgdGhlIGJlc3Qgb25lLiBXZSB3aWxsIGtlZXAgdGhlIG1vc3QgcGFyc2ltb25pb3VzIG9uZSB3aXRoIGFuIEFJQyBjb21wYXJhYmxlIHRvIHRoZSBmdWxsIG1vZGVsLgoKRmlyc3QgbGV0J3MgYnVpbGQgdGhlIGZ1bGwgbW9kZWwgdG8gaGF2ZSBhIHBvaW50IG9mIHJlZmVyZW5jZSBvZiB3aGF0J3MgYSBnb29kIEFJQzoKCmBgYHtyfQptb2RlbC5jaHVybi5mdWxsIDwtIGdsbShDaHVybmVkIH4gLiwKICAgICAgICAgICAgICAgICAgIGZhbWlseSA9IGJpbm9taWFsKGxpbms9J2xvZ2l0JyksCiAgICAgICAgICAgICAgICAgICBkYXRhID0gY3VzdG9tZXIuYWN0aXZlKQoKc3VtbWFyeShtb2RlbC5jaHVybi5mdWxsKQpgYGAKClNvIHdlIHdhbnQgYSBtb2RlbCB3aXRoIGFuIEFJQyBhcyBjbG9zZSBhcyBwb3NzaWJsZSBmcm9tIDE1MDAuCgpGaXJzdCwgbGV0J3MgYnVpbGQgb3VyIGZpcnN0IG1vZGVsIG9ubHkgYmFzZWQgb24gdGhlIGZhbGwgYm9udXM6CgpgYGB7cn0KbW9kZWwuY2h1cm4uMSA8LSBnbG0oQ2h1cm5lZCB+IGZhbGxib251cyAtMSwKICAgICAgICAgICAgICAgICAgICAgZmFtaWx5ID0gYmlub21pYWwobGluaz0nbG9naXQnKSwKICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGN1c3RvbWVyLmFjdGl2ZSkKc3VtbWFyeShtb2RlbC5jaHVybi4xKQpgYGAKClRoZSBmYWxsIGJvbnVzIGhhcyBpbmRlZWQgYSBzaWduaWZpY2FudCBpbXBhY3Qgb24gY2h1cm4gYnV0IGl0IG5vdCBiZSB0aGUgb25seSB2YXJpYWJsZSB0byBjb25zaWRlciB0byBwcmVkaWN0IGNodXJuIGJlY2F1c2UgdGhlIEFJQyBpcyBxdWl0ZSBmYXIgZnJvbSB0aGUgZnVsbCBtb2RlbCdzIEFJQy4KCkxldCdzIGFkZCB0aGUgUmVjZW5jeSBjcml0ZXJpdW0gYXMgb25lIGNhbiBpbWFnaW5lIHRoYXQgYSBwbGF5ZXIgd2hvIGp1c3QgYm91Z2h0IGFuIGl0ZW0gaGFzIGxvd2VyIGNoYW5jZXMgdG8gY2h1cm46CgpgYGB7cn0KbW9kZWwuY2h1cm4uMiA8LSBnbG0oQ2h1cm5lZCB+IGZhbGxib251cyArIFJlY2VuY3kgLTEsCiAgICAgICAgICAgICAgICAgICAgIGZhbWlseSA9IGJpbm9taWFsKGxpbms9J2xvZ2l0JyksCiAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjdXN0b21lci5hY3RpdmUpCnN1bW1hcnkobW9kZWwuY2h1cm4uMikKYGBgCgpOb3cgd2UgbWlnaHQgd2FudCB0byBhZGQgdGhlIEV4cGVyaWVuY2UgdmFyaWFibGUgYXMgYSB1c2VyIHRoYXQgYWxyZWFkeSBwbGF5ZWQgYSBsb3QgaXMgbGVzcyBsaWtlbHkgdG8gc3RvcCBkdWUgdG8gc3VuayBjb3N0IGZhbGxhY3k6CgpgYGB7cn0KbW9kZWwuY2h1cm4uMyA8LSBnbG0oQ2h1cm5lZCB+IGZhbGxib251cyArIFJlY2VuY3kgKyBFeHBlcmllbmNlIC0xLAogICAgICAgICAgICAgICAgICAgZmFtaWx5ID0gYmlub21pYWwobGluaz0nbG9naXQnKSwKICAgICAgICAgICAgICAgICAgIGRhdGEgPSBjdXN0b21lci5hY3RpdmUpCgpzdW1tYXJ5KG1vZGVsLmNodXJuLjMpCmBgYAoKVGhpcyBsYXN0IG1vZGVsIHNlZW1zIHF1aXRlIGdvb2QgYXMgd2UgaGF2ZSBhbG1vc3QgdGhlIHNhbWUgQUlDIGNyaXRlcmlvbiBhcyB0aGUgZnVsbCBtb2RlbCwgd2hpY2ggbWVhbnMgdGhhdCB0aGlzIG1vZGVsIGNvbnRhaW5zIGFsbW9zdCB0aGUgc2FtZSBhbW91bnQgb2YgaW5mb3JtYXRpb24gYXMgdGhlIGJlc3Qgb25lIGluIHRoZSBmYW1pbHkgb2YgdGhlIGxvZ2lzdGljIHJlZ3Jlc3Npb24gbW9kZWxzLgoKVGh1cywgd2UgbWF5IGNvbmNsdWRlIHRoYXQgdGhlIGZhbGwgYm9udXMsIHRoZSByZWNlbmN5IG9mIGJ1eWluZyBhbmQgdGhlIGV4cGVyaWVuY2Ugb2YgdGhlIHBsYXllciBhcmUgdGhlIHRocmVlIHZhcmlhYmxlcyB0aGF0IGV4cGxhaW5zIG1vc3Qgb2YgdGhlIHByZWRpY3RhYmxlIGNodXJuLgoKVG8gYXZvaWQgY2h1cm5pbmcgaW4gdGhlIGZ1dHVyZSwgd2UgaGF2ZSBidWlsZCBtYXJrZXRpbmcgc3RyYXRlZ2llcyB0aGF0IHdpbGwgbWF4aW1pc2UgdGhlIGV4cGVyaWVuY2UgZ2FpbiBieSB0aGUgcGxheWVycyBhbmQgbWluaW1pc2UgdGhlaXIgcmVjZW5jeS4KClRodXMsIHdlIHRoaW5rIGFib3V0IGdpdmluZyBib251cyBvZiBleHBlcmllbmNlIGZvciB0aGUgcGxheWVycyBkdXJpbmcgdGhlIDE1IGRheXMgZm9sbG93aW5nIHRoZSBwdXJjaGFzZSBhIHByb2R1Y3QuIFRoaXMgd2lsbCBnaXZlIGFuIGluY2VudGl2ZSB0byB0aGUgcGxheWVycyB0byBrZWVwIHBsYXlpbmcgYW5kIHB1cmNoYXNpbmcsIHNvIGl0IHdpbGwgZGVjcmVhc2UgcmVjZW5jeS4KClRvIG1heGltaXNlIHRoZSBleHBlcmllbmNlIG9mIHRoZSBwbGF5ZXIsIHRoZSBpZGVhIGlzIHRvIGdpdmUgYm9udXMgb2YgZXhwZXJpZW5jZSBmb3Igc3BlY2lhbCBxdWVzdHMgYWNoaWV2ZW1lbnRzICYgY2hhbGxlbmdlcy4gV2UgZG8gbm90IHdhbnQgdG8gZGVjcmVhc2UgdGhlIHZhbHVlIG9mIGV4cGVyaWVuY2UsIGl0IGhhcyB0byBiZSBhIGZhaXIgcmV3YXJkLiBUaHVzLCB3ZSB3aWxsIHByb3Bvc2UgZm9yIGluc3RhbmNlIGJvbnVzIG9mIGV4cGVyaWVuY2UgdG8gdGhlIHBsYXllcnMgd2hvIGNhdGNoZWQgMTAgcG9rZW1vbnMgb2YgdHlwZSBXYXRlciBkdXJpbmcgZml2ZSBkYXlzLgoKIyMjIENhbGN1bGF0aW9uIGZvciBDUk0gcmVjb21tZW5kYXRpb24KCmBgYHtyfQpjdXN0b21lci5hY3RpdmUgJT4lIGdyb3VwX2J5KEN1c3RvbWVyVHlwZSkgJT4lIHN1bW1hcmlzZShtZWFuKE1vbmV0YXJ5KSxtZWFuKEZyZXF1ZW5jeSksbWVhbihDTFYpKQpgYGAK</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
